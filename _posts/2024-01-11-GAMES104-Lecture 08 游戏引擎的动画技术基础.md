---
title: GAMES104-Lecture 08 游戏引擎的动画技术基础
date: 2024-01-11 16:48:00 +0800
categories: [Computer Graphics, GAMES104]
tags: [图形学, 学习笔记]

pin: false
author: 
    name: CALL1CE
    link: https://space.bilibili.com/9330604
toc: true
comments: true
math: true
mermaid: true

---

## Challenges

可交互性和动态变化的动画：

* 在游戏中不能预设玩家的行为

* 游戏中的动画要和很多gameplay互动

* 受制于周围的环境

实时：

* 每一帧都要计算

* 动画数据很大

真实度：

* 更生动

* 表情

## Basics of Animation Technology

### 2D Animation

* Sprite animation

* Sprite-like animation technique in pseudo-3D game：在各个视角采了一系列的位置，根据相机的位置播放不同的sprit动画

* 粒子系统：是一个序列帧

* Live2D：
  
  * 把角色的所有元素分解成一个一个的小图元，通过旋转、放缩、变形
  
  * 给所有的图元设置深度
  
  * 给每一个图元生成一个控制网格
  
  * 设置key frame

### 3D Animation

* DoF(Degrees of Freedom)

[![pFi7hIx.jpg](https://s11.ax1x.com/2024/01/15/pFi7hIx.jpg)](https://imgse.com/i/pFi7hIx)

* 6DoFs：平移的三个自由度（xyz），旋转的三个自由度（xyz）

* Rigid Hierarchical Animation：层次结构刚体动画
  
  * 问题是骨骼转的时候mesh彼此会穿插

* Per-vertex Animation：顶点动画
  
  * 把每个顶点的offset按时间序列存在一个texture里面
  
  * 横轴是每个顶点的offset（有时也会把法线存下来）
  
  * 纵轴是时间

[![pFi75i6.jpg](https://s11.ax1x.com/2024/01/15/pFi75i6.jpg)](https://imgse.com/i/pFi75i6)

* Morph Target Animation（也是一种顶点动画）
  
  * 在顶点之间的Key Frame去插值

* 3D Skinned Animation
  
  * 蒙皮动画，每个顶点受到多根骨骼的影响，来保证在运动的时候是水密性的，不会互相穿插

* 2D Skinned Animation

* Physics-based Animation
  
  * 布娃娃系统Ragdoll
  
  * 衣料模拟
  
  * Inverse Kinematics(IK)反向动力学
    
    * 给定一个指定点，角色该怎么运动才最自然

* Animation Content Creation
  
  * 在编辑器里手key动画
  
  * 动作捕捉

### Skinned Animation Implementation

* How to Animate a Mesh
  
  * Mesh：先做一个网格
  
  * Skeleton：为网格适配一套骨骼
  
  * Skinning/Rig：刷上一层蒙皮，给每一个顶点设置骨骼的权重（也就是顶点收到哪个骨骼影响大，影响小）
  
  * Pose：让骨骼按照指定的动作动画
  
  * Animation

* Different Spaces
  
  * World Space
  
  * Model Space：以模型为中心的space
  
  * Local Space：局部坐标系，每一根骨骼会平移旋转，每个骨骼的坐标系是不同的，坐标系会传递
  
  * 把Local坐标系从根节点，一路积分上来，才能算出model space，然后考虑模型的位置和旋转，才能再转换成世界坐标系，然后才能被渲染

[![pFi7fd1.jpg](https://s11.ax1x.com/2024/01/15/pFi7fd1.jpg)](https://imgse.com/i/pFi7fd1)

* Skeleton for Creature
  
  * 人的骨骼，root一般在胯部，Pelvis，脊椎末端

[![pFi72L9.jpg](https://s11.ax1x.com/2024/01/15/pFi72L9.jpg)](https://imgse.com/i/pFi72L9)

* Joint vs. Bone
  
  * Joint关节：会直接存储关节的数据，因为关节会带动bone动，不会直接存储bone的数据
  
  * joint是有很多自由度的
  
  * joint是一个刚体，不会被twist（扭曲），但Bone会

[![pFi7yzF.jpg](https://s11.ax1x.com/2024/01/15/pFi7yzF.jpg)](https://imgse.com/i/pFi7yzF)

* Humaniod Skeleton in Real Game
  
  * 人脸上可能要加很多骨骼来做细节、翅膀、斗篷的骨骼
  
  * 所以要提前设定好标准骨骼数是多少

* Joints for Game Play
  
  * 武器要mount（镶嵌）到手上的武器joint上

[![pFi7cM4.jpg](https://s11.ax1x.com/2024/01/15/pFi7cM4.jpg)](https://imgse.com/i/pFi7cM4)

* Root Joint
  
  * 脚的中心，用来判断离地高度
  
  * Pelvis joint是root joint的第一个child joint

[![pFi7WZR.jpg](https://s11.ax1x.com/2024/01/15/pFi7WZR.jpg)](https://imgse.com/i/pFi7WZR)

* Horse Skeleton
  
  * 四足动物的尾椎骨是Pelvis joint
  
  * root在肚子下面

[![pFi7gsJ.jpg](https://s11.ax1x.com/2024/01/15/pFi7gsJ.jpg)](https://imgse.com/i/pFi7gsJ)

* Bind Animation for Objects
  
  * 一些object是有父子关系的，有些动画是绑定的
  
  * 在人的身上有一个Mount的joint，马鞍位置也有一个Mount的joint，这两个joint重合在一起，不仅是位置重合，旋转也是重合的；人和车也有

[![pFFBYOe.jpg](https://s11.ax1x.com/2024/01/16/pFFBYOe.jpg)](https://imgse.com/i/pFFBYOe)

* Bind Pose - T-pose vs. A-pose
  
  * T-pose角色的肩膀部分其实是挤压的，所以目前一般就会给A-pose，这样肩胛处精度会高一点

* Skeleton Pose
  
  * 骨骼一个动作静止的状态叫做pose
  
  * 把pose连在一起就是一个动画
  
  * 在真正表达一个动画的pose的时候是有9个自由度的9DoFs，也就是放缩

### Math of 3D Rotation

* 2D Orientation Math

[![pFFBGQO.jpg](https://s11.ax1x.com/2024/01/16/pFFBGQO.jpg)](https://imgse.com/i/pFFBGQO)

* 3D Orientation Math

[![pFFBJyD.jpg](https://s11.ax1x.com/2024/01/16/pFFBJyD.jpg)](https://imgse.com/i/pFFBJyD)

* Euler Angle：Yaw航向角、Pitch攻角、Roll横滚角

[![pFFBKoR.jpg](https://s11.ax1x.com/2024/01/16/pFFBKoR.jpg)](https://imgse.com/i/pFFBKoR)

* 转的顺序不同，效果也不同

* Gimbal Lock万向结
  
  * 陀螺仪：可以用来测导弹的轨迹
  
  * 稳定器

* Degeneration of Euler Angle
  
  * 当一个轴转了90度时死锁

* Problems of Euler Angle
  
  * 难以插值
  
  * 欧拉角的叠加很难
  
  * 容易沿着xyz轴转，但难以沿着其他轴转

* Quaternion 四元数
  
  * Complex Number（复数）and 2D Rotation

[![pFFBQF1.jpg](https://s11.ax1x.com/2024/01/16/pFFBQF1.jpg)](https://imgse.com/i/pFFBQF1)

* Quaternion，模、共轭（虚部全部取负数）、逆（normalized的四元数的共轭就是它的逆）

[![pFFBlJx.jpg](https://s11.ax1x.com/2024/01/16/pFFBlJx.jpg)](https://imgse.com/i/pFFBlJx)

* 在做旋转的时候，需要先乘以q转换为四元数，旋转完后再乘以q^-1

* Rotation Math by Quaternion

[![pFFB1W6.jpg](https://s11.ax1x.com/2024/01/16/pFFB1W6.jpg)](https://imgse.com/i/pFFB1W6)

* Given Axis Rotation by Quaternion

[![pFFB8SK.jpg](https://s11.ax1x.com/2024/01/16/pFFB8SK.jpg)](https://imgse.com/i/pFFB8SK)

### Animation Compression

### Animation DCC

## Advanced Animation Technology

### Animation Blend

### Animation Kinematics

### Animation Pipeline

### Animation Graph

### Facial Animation

### Retargeting
