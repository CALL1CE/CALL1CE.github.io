---
title: GAMES104-Lecture 06 游戏中地形大气和云的渲染
date: 2024-01-06 15:07:00 +0800
categories: [Computer Graphics, GAMES104]
tags: [图形学, 学习笔记]

pin: false
author: 
    name: CALL1CE
    link: https://space.bilibili.com/9330604
toc: true
comments: true
math: true
mermaid: true

---

## Environment Components

* Sky and Cloud

* Vegetation

* Terrain

### LODs

* Level of details

## Terrain Rendering

### Simple Idea - Heightfield

* height map + Contour map

[![pizrtyR.jpg](https://s11.ax1x.com/2024/01/06/pizrtyR.jpg)](https://imgse.com/i/pizrtyR)

* Adaptive Mesh Tessellation
  
  * 关心fov内的东西，fov内的三角形会被细化，fov外面和远处的三角形会分布得比较稀疏
  
  * 瞄准镜就只是修改了fov，观察角度减小，相同的三角形，在更小的fov下占的像素会增加

* 2条优化黄金法则
  
  * 近处密 远处稀疏，fov窄密 宽稀疏
  
  * 与实际值的误差控制

* Triangle-based subdivision
  
  * 永远把等腰直角三角形最长的一边切一刀，得到两个新的等腰直角三角形，这是一个二叉树的结构

[![pizrJSJ.jpg](https://s11.ax1x.com/2024/01/06/pizrJSJ.jpg)](https://imgse.com/i/pizrJSJ)

* Subdivision and T-Junctions
  
  * 这个问题就是指相邻两个三角形的共用边处，只对其中一个三角形细分而另一个没有，就会产生T-Junctions，解决方法就是没细分的三角形也被迫细分一下

* QuadTree-Based subdivision
  
  * 优点：容易构建、quad符合数据规范
  
  * 缺点：也有T-Junctions（解决方法：Stitching，多的点吸附到其他点，形成退化三角形（面积为0））

* Triangulated Irregular Network(TIN)
  
  * 使用不规则的三角形，
  
  * 优点：运行时快、三角形数量更少
  
  * 缺点：需要预处理、很难重复利用

[![pizraex.jpg](https://s11.ax1x.com/2024/01/06/pizraex.jpg)](https://imgse.com/i/pizraex)

* GPU-Based Tessellation
  
  * Mesh Shader Pipeline
  
  * Real Time Deformable Terrain

[![pizrNO1.jpg](https://s11.ax1x.com/2024/01/06/pizrNO1.jpg)](https://imgse.com/i/pizrNO1)

### Non-Heightfield Terrain

* Volumetric Representation体素化表达

* Marching Cubes：扫描的点通过该算法构造出形状（三角面片集）

[![pizrYl9.jpg](https://s11.ax1x.com/2024/01/06/pizrYl9.jpg)](https://imgse.com/i/pizrYl9)

### Paint Terrain Materials

[![pizrdw6.jpg](https://s11.ax1x.com/2024/01/06/pizrdw6.jpg)](https://imgse.com/i/pizrdw6)

* Terrain Materials，材质混合，简单blend会不真实

* Advanced Teture Splatting - Biased

[![pizrwTK.jpg](https://s11.ax1x.com/2024/01/06/pizrwTK.jpg)](https://imgse.com/i/pizrwTK)

* Sampling from Material Texture Array
  
  * 存权重和材质索引



* Parallax and displacement Mapping

* Expensive Material Blending
  
  * 每个像素都要算一遍

* **Virtual Texture**：减小显存中的texture，还可以pre-bake，从显存、内存、硬盘之间调度数据
  
  * VT Implementation， DirectStorage & DMA：不经过内存，直接往显存里写数据

[![pizrBFO.jpg](https://s11.ax1x.com/2024/01/06/pizrBFO.jpg)](https://imgse.com/i/pizrBFO)

* Floating-point Precision Error 浮点数溢出
  
  * 解决方案：Camera-Relative Rendering
    
    * 先把每个物体的位置减去相机的位置，然后对物体进行transform，最后把相机位置设置为0，更新mvp矩阵

* Tree Rendering：每种树都有LODs

* Decorator Rendering：装饰性渲染，比如草

* Road and decals Rendering
  
  * decals类似子弹的弹坑，小贴图，把decals放在virtual texture里


