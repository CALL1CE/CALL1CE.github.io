<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="复刻《PokemonGo》部分功能的学习记录" /><meta name="author" content="CALL1CE" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="一、实验摘要" /><meta property="og:description" content="一、实验摘要" /><link rel="canonical" href="/posts/%E5%A4%8D%E5%88%BB-PokemonGo-%E9%83%A8%E5%88%86%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" /><meta property="og:url" content="/posts/%E5%A4%8D%E5%88%BB-PokemonGo-%E9%83%A8%E5%88%86%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" /><meta property="og:site_name" content="CALL1CE" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-02T02:47:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="复刻《PokemonGo》部分功能的学习记录" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"CALL1CE"},"dateModified":"2022-10-07T05:40:11+00:00","datePublished":"2022-06-02T02:47:00+00:00","description":"一、实验摘要","headline":"复刻《PokemonGo》部分功能的学习记录","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/%E5%A4%8D%E5%88%BB-PokemonGo-%E9%83%A8%E5%88%86%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"},"url":"/posts/%E5%A4%8D%E5%88%BB-PokemonGo-%E9%83%A8%E5%88%86%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"}</script><title>复刻《PokemonGo》部分功能的学习记录 | CALL1CE</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="CALL1CE"><meta name="application-name" content="CALL1CE"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/config/CALL1CE.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">CALL1CE</a></div><div class="site-subtitle font-italic">一位正在练习敲代码的OW2玩家</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/CALL1CE" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['563638083','qq.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>复刻《PokemonGo》部分功能的学习记录</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> </span> <span id="search-cancel" >取消</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>复刻《PokemonGo》部分功能的学习记录</h1><div class="post-meta text-muted"> <span> 发表于 <em class="" data-ts="1654138020" data-df="YYYY/MM/DD" data-toggle="tooltip" data-placement="bottom"> 2022/06/02 </em> </span> <span> 更新于 <em class="" data-ts="1665121211" data-df="YYYY/MM/DD" data-toggle="tooltip" data-placement="bottom"> 2022/10/07 </em> </span><div class="d-flex justify-content-between"> <span> 作者 <em> <a href=""></a> </em>, <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="11163 字"> <em>62 分钟</em>阅读</span></div></div></div><div class="post-content"><h2 id="一实验摘要"><span class="mr-2">一、实验摘要</span><a href="#一实验摘要" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>    《宝可梦GO》是一款能对现实世界中出现的宝可梦进行探索捕捉、战斗以及交换的游戏。玩家可以通过智能手机在现实世界里发现宝可梦，进行抓捕和战斗。玩家作为宝可梦训练师抓到的宝可梦越多会变得越强大，从而有机会抓到更强大更稀有的宝可梦。</p><p>    本次实验复刻了宝可梦GO的LBS地图系统、AR捕捉系统以及仓库系统。</p><h2 id="二实验过程"><span class="mr-2">二、实验过程</span><a href="#二实验过程" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="0环境介绍"><span class="mr-2">0.环境介绍</span><a href="#0环境介绍" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p>Unity2017.3.1</p><li><p>Andriod SDK 、NDK、OpenJDK均来自于Unity2020.3.14版本安卓模块</p></ul><h3 id="1游戏内容分析"><span class="mr-2">1.游戏内容分析</span><a href="#1游戏内容分析" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h4 id="传统部分"><span class="mr-2">传统部分</span><a href="#传统部分" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li><p>选择阵营，参与争夺</p><li><p>宠物捕捉</p><li><p>宠物升级进化</p><li><p>宠物PK</p><li><p>道具系统：收集，购买</p></ol><h4 id="创新内容"><span class="mr-2">创新内容</span><a href="#创新内容" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li><p>LBS：</p><ul><li><p>增加与现实世界互动</p><li><p>增加玩家代入感</p><li><p>增加社交互动</p></ul><li><p>AR</p><ul><li><p>增加现实世界互动</p><li><p>形式新奇</p></ul></ol><h3 id="2项目设计"><span class="mr-2">2.项目设计</span><a href="#2项目设计" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p>app功能</p><ol><li><p>用户登录</p><li><p>LBS基于地理的服务功能</p><li><p>AR捉宠功能</p><li><p>宠物仓库功能</p><li><p>数据更新与保存</p></ol><li><p>制作流程及标准</p><ol><li><p>以模块的形式做成独立的项目</p><li><p>LBS使用GoMap插件</p><li><p>AR使用Vuforia</p><li><p>宠物仓库</p><li><p>UGUI制作登陆界面</p></ol><li><p>资源</p><ol><li><p>角色模型</p><li><p>精灵球、食物模型</p><li><p>卡通宠物模型</p><li><p>UI美术</p><li><p>粒子特效及音效</p></ol></ul><h3 id="3unity实现lbs服务location-based-service"><span class="mr-2">3.unity实现LBS服务（Location Based Service）</span><a href="#3unity实现lbs服务location-based-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>先配置环境<ul><li>unity2017.3.1</ul></ol><ul><li>安卓SDK（我用的是unity2021版本自带的sdk）<ol><li>导入GoMap插件包</ol></ul><ol><li><p>在demo文件夹拷贝一个POI demo的场景</p><li><p>build出一个安卓apk进行测试（注意在导出之前要更改player setting中的package name）</p></ol><h3 id="4获取地图运营商密钥"><span class="mr-2">4.获取地图运营商密钥</span><a href="#4获取地图运营商密钥" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li>在mapbox官网注册账号<li>点击token创建新的token<li>选择默认选项即可<li>注意，一开始申请注册账号的时候需要visa信用卡，就放弃了注册，但后来给我发送了确认邮件，我验证后就注册成功了</ol><h3 id="5gomap的图块机制"><span class="mr-2">5.GoMap的图块机制</span><a href="#5gomap的图块机制" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039909.png" class="popup img-link "><img data-src="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039909.png" alt="" class="lazyload" data-proofer-ignore></a></p><ol><li><p>tile buffer</p><p>图块缓冲越大，一次申请访问的地图就越大</p><li><p>Coordinates / units Ratio</p><p>单位取真实世界的米</p><li><p>Zoom level</p><p>值越大，地图比例越小。放大和缩小不会更改比例尺，意味着放再大单位还是取真实世界的米</p></ol><h3 id="6gomap的坐标机制"><span class="mr-2">6.GoMap的坐标机制</span><a href="#6gomap的坐标机制" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>    开始游戏时，世界中心坐标将会和场景中心坐标(0,0,0)匹配，并且不会变动，人物的行走会改变人物的位置坐标，这与普通地图SDK有所不同（普通地图SDK人物不产生位移，地图画面移动）</p><h3 id="7设置地图玩家角色"><span class="mr-2">7.设置地图玩家角色</span><a href="#7设置地图玩家角色" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li><p>替换角色模型</p><ul><li>修改角色比例与方向，再拖到Avatar下，将角色物体拖到Avtar物体的Move Avtar脚本的Avatar Figure上</ul><li><p>让模型根据移动速度产生动画的变化</p><ul><li><p>创建Animator文件夹（在Avatar_01下），创建Animator controller作为角色模型的控制器</p><li><p>将animation文件夹中的Idle、run、walk拖入控制器</p><li><p>将any state连接（Transition）三个动画</p><li><p>在any state中添加参数：三个trigger（idle、run、walk）</p><li><p>在三个连接中添加对应的条件（condition）</p><li><p>将控制器拖到模型Boy的Animator组件的controller中</p></ul><li><p>写脚本控制动画</p><ul><li>创建文件夹，创建脚本BoyControl.cs</ul><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
   
<span class="k">public</span> <span class="k">class</span> <span class="nc">BoyControl</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
<span class="c1">//储存动画控制器</span>
<span class="k">private</span> <span class="n">Animator</span> <span class="n">ator</span><span class="p">;</span>
<span class="c1">//储存角色控制器</span>
<span class="k">private</span> <span class="n">MoveAvatar</span> <span class="n">moveAvatar</span><span class="p">;</span>
<span class="c1">// Use this for initialization</span>
<span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//获取动画控制器</span>
    <span class="n">ator</span> <span class="p">=</span> <span class="n">gameObject</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Animator</span><span class="p">&gt;();</span>
    <span class="c1">//获取父物体的角色控制器</span>
    <span class="n">moveAvatar</span> <span class="p">=</span> <span class="n">transform</span><span class="p">.</span><span class="n">parent</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MoveAvatar</span><span class="p">&gt;();</span>
<span class="p">}</span>
   
<span class="c1">// Update is called once per frame</span>
<span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">//如果角色控制器当前的状态是 定义的待机状态</span>
    <span class="k">if</span><span class="p">(</span><span class="n">moveAvatar</span><span class="p">.</span><span class="n">animationState</span> <span class="p">==</span> <span class="n">MoveAvatar</span><span class="p">.</span><span class="n">AvatarAnimationState</span><span class="p">.</span><span class="n">Idle</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//而且当前动画不是待机动画，就将动画控制器的动画设置为待机</span>
        <span class="k">if</span><span class="p">(!</span><span class="n">ator</span><span class="p">.</span><span class="nf">GetCurrentAnimatorStateInfo</span><span class="p">(</span><span class="m">0</span><span class="p">).</span><span class="nf">IsName</span><span class="p">(</span><span class="s">"Idle"</span><span class="p">))</span><span class="n">ator</span><span class="p">.</span><span class="nf">SetTrigger</span><span class="p">(</span><span class="s">"Idle"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">moveAvatar</span><span class="p">.</span><span class="n">animationState</span> <span class="p">==</span> <span class="n">MoveAvatar</span><span class="p">.</span><span class="n">AvatarAnimationState</span><span class="p">.</span><span class="n">Run</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">ator</span><span class="p">.</span><span class="nf">GetCurrentAnimatorStateInfo</span><span class="p">(</span><span class="m">0</span><span class="p">).</span><span class="nf">IsName</span><span class="p">(</span><span class="s">"Run"</span><span class="p">))</span> <span class="n">ator</span><span class="p">.</span><span class="nf">SetTrigger</span><span class="p">(</span><span class="s">"Run"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">moveAvatar</span><span class="p">.</span><span class="n">animationState</span> <span class="p">==</span> <span class="n">MoveAvatar</span><span class="p">.</span><span class="n">AvatarAnimationState</span><span class="p">.</span><span class="n">Walk</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">ator</span><span class="p">.</span><span class="nf">GetCurrentAnimatorStateInfo</span><span class="p">(</span><span class="m">0</span><span class="p">).</span><span class="nf">IsName</span><span class="p">(</span><span class="s">"Walk"</span><span class="p">))</span> <span class="n">ator</span><span class="p">.</span><span class="nf">SetTrigger</span><span class="p">(</span><span class="s">"Walk"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><ol><li>将main camera的target设置为boy模型，保证视角的正确</ol></ol><h3 id="8范围内生成随机点"><span class="mr-2">8.范围内生成随机点</span><a href="#8范围内生成随机点" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li><p>指定预制体作为事件点的载体</p><li><p>获取角色坐标信息</p><li><p>定义随机点与角色距离范围</p><li><p>在距离范围内取一个随机坐标</p><li><p>在随机坐标的位置生成随机点预制体</p><ul><li>新建一个cube改名为EventPoint，拖到创建的prefab文件夹</ul></ol><ul><li><p>新建脚本InsPoint.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">InsPoint</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
    <span class="c1">//储存地图角色</span>
    <span class="k">public</span> <span class="n">GameObject</span> <span class="n">Ava</span><span class="p">;</span>
    <span class="c1">//储存事件点预制体</span>
    <span class="k">public</span> <span class="n">GameObject</span> <span class="n">PrePoint</span><span class="p">;</span>
    <span class="c1">//储存距离范围最小点</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">MinDis</span> <span class="p">=</span> <span class="m">3f</span><span class="p">;</span>
    <span class="c1">//储存距离范围最大点</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">MaxDis</span> <span class="p">=</span> <span class="m">50f</span><span class="p">;</span>
    <span class="c1">//储存当前角色当前位置</span>
    <span class="k">private</span> <span class="n">Vector3</span> <span class="n">v3Ava</span><span class="p">;</span>
    <span class="c1">// Use this for initialization</span>
    <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
  
    <span class="p">}</span>
  
    <span class="c1">// Update is called once per frame</span>
    <span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
  
    <span class="p">}</span>
  
    <span class="k">public</span> <span class="k">void</span> <span class="nf">InsPointFuc</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//获取角色坐标位置</span>
        <span class="n">v3Ava</span> <span class="p">=</span> <span class="n">Ava</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
        <span class="c1">//从距离范围内取一个随机距离值</span>
        <span class="kt">float</span> <span class="n">_dis</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="n">MinDis</span><span class="p">,</span> <span class="n">MaxDis</span><span class="p">);</span>
        <span class="c1">//从原点为（0，0）随机获取一个方向的向量</span>
        <span class="n">Vector2</span> <span class="n">_pOri</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="n">insideUnitCircle</span><span class="p">;</span>
        <span class="c1">//将该方向向量标准化</span>
        <span class="n">Vector2</span> <span class="n">_pNor</span> <span class="p">=</span> <span class="n">_pOri</span><span class="p">.</span><span class="n">normalized</span><span class="p">;</span>
        <span class="c1">//计算生成随机点的位置向量             随机点x坐标              随机点y坐标</span>
        <span class="n">Vector3</span> <span class="n">_v3Point</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">v3Ava</span><span class="p">.</span><span class="n">x</span> <span class="p">+</span> <span class="n">_pNor</span><span class="p">.</span><span class="n">x</span> <span class="p">*</span> <span class="n">_dis</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">v3Ava</span><span class="p">.</span><span class="n">z</span> <span class="p">+</span> <span class="n">_pNor</span><span class="p">.</span><span class="n">y</span> <span class="p">*</span> <span class="n">_dis</span><span class="p">);</span>
        <span class="c1">//生成随机点的预制体</span>
        <span class="n">GameObject</span> <span class="n">poiMark</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">PrePoint</span><span class="p">,</span> <span class="n">_v3Point</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
  
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>新建一个空物体作为manager，删掉之前创建的eventpoint物体</p><li><p>将随机点生成脚本挂载manager上</p><li><p>将avtar、预制体prePoint拖到manager的脚本上</p><li><p>创建canvas，创建按钮（锚点右上角），添加manager中的随机点函数到按钮中</p></ul><h3 id="9在地图上生成随机事件"><span class="mr-2">9.在地图上生成随机事件</span><a href="#9在地图上生成随机事件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>随机事件</strong>：</p><ol><li><p>生成小精灵</p><li><p>生成精灵球</p><li><p>生成食物</p></ol><p><strong>实现手段：</strong></p><ol><li><p>制作三个预制体</p><li><p>在随机点的脚本中随机选取事件</p><li><p>生成对应的预制体</p></ol><p><strong>具体流程</strong></p><ul><li><p>导入资源包食物和精灵球，放到package文件夹下</p><li><p>将资源包中prefab的蛋糕和精灵球拖到hierarchy修改比例后放到工程的prefab文件夹作为预制体（将精灵球刚体组件删掉）</p><li><p>创建一个圆柱暂时作为宠物</p><li><p>新建脚本PointEvent.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">PointEvent</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
  
    <span class="c1">//分别储存精灵、精灵球、食物的预制体</span>
    <span class="k">public</span> <span class="n">GameObject</span> <span class="n">Pet</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">GameObject</span> <span class="n">Ball</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">GameObject</span> <span class="n">Food</span><span class="p">;</span>
    <span class="c1">//储存偏移量</span>
    <span class="k">private</span> <span class="n">Vector3</span> <span class="n">offset</span><span class="p">;</span>
    <span class="c1">// Use this for initialization</span>
    <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">_randomEvent</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">3</span><span class="p">);</span><span class="c1">//随机选 0 1 2</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_randomEvent</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="nf">insPet</span><span class="p">();</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">_randomEvent</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span> <span class="nf">insBall</span><span class="p">();</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">_randomEvent</span> <span class="p">==</span> <span class="m">2</span><span class="p">)</span> <span class="nf">insFood</span><span class="p">();</span>
  
        <span class="n">offset</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">5f</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
    <span class="p">}</span>
  
    <span class="c1">// Update is called once per frame</span>
    <span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
  
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">insPet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">Instantiate</span><span class="p">(</span><span class="n">Pet</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
    <span class="p">}</span>    
    <span class="k">private</span> <span class="k">void</span> <span class="nf">insFood</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">Instantiate</span><span class="p">(</span><span class="n">Food</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
    <span class="p">}</span>    
    <span class="k">private</span> <span class="k">void</span> <span class="nf">insBall</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">GameObject</span> <span class="n">_ball</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">Ball</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
        <span class="c1">//设置精灵球的角度</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">localEulerAngles</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(-</span><span class="m">30f</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>将脚本挂载到eventPoint预制体上，并将蛋糕、精灵球和精灵（现在是圆柱）挂载在脚本上</p><li><p>删掉eventPoint预制体上的meshrender和cube组件（不用显示）</p><li><p>新建脚本MoveEffect.cs控制随机生成的物体的动态效果</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">MoveEffect</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
  
    <span class="c1">//设置起始弧度参数</span>
    <span class="k">private</span> <span class="kt">float</span> <span class="n">radian</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>
    <span class="c1">//弧度变化值</span>
    <span class="k">private</span> <span class="kt">float</span> <span class="n">perRad</span> <span class="p">=</span> <span class="m">0.03f</span><span class="p">;</span>
    <span class="c1">//位移偏移量</span>
    <span class="k">private</span> <span class="kt">float</span> <span class="k">add</span> <span class="p">=</span> <span class="m">0f</span><span class="p">;</span>
    <span class="c1">//储存物体生成时的真实坐标</span>
    <span class="k">private</span> <span class="n">Vector3</span> <span class="n">posOri</span><span class="p">;</span>
    <span class="c1">// Use this for initialization</span>
    <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">//获取初始位置的坐标信息，否则就是0，0，0</span>
        <span class="n">posOri</span> <span class="p">=</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="c1">// Update is called once per frame</span>
    <span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
  
        <span class="c1">//弧度值变化</span>
        <span class="n">radian</span> <span class="p">+=</span> <span class="n">perRad</span><span class="p">;</span>
        <span class="c1">//计算偏移量</span>
        <span class="k">add</span> <span class="p">=</span> <span class="n">Mathf</span><span class="p">.</span><span class="nf">Sin</span><span class="p">(</span><span class="n">radian</span><span class="p">);</span>
        <span class="c1">//更改物体位置</span>
        <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">posOri</span> <span class="p">+</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="k">add</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
  
        <span class="c1">//控制物体旋转（我试了下，无论是space.self还是world都是绕自己y轴旋转 怪）</span>
        <span class="n">transform</span><span class="p">.</span><span class="nf">Rotate</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span> <span class="p">*</span> <span class="m">25f</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">Space</span><span class="p">.</span><span class="n">World</span><span class="p">);</span>
  
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div></ul><h3 id="10生成精灵"><span class="mr-2">10.生成精灵</span><a href="#10生成精灵" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>实现方式：</strong></p><ol><li><p>制作精灵预制体</p><li><p>使用resource加载预制体</p><li><p>编写随机生成事件</p></ol><p><strong>制作流程</strong></p><ul><li><p>导入精灵包</p><li><p>将精灵包文件夹中prefab-&gt;low poly -&gt; naked中的预制体拖到hierarchy中，修改大小，改名字为01</p><li><p>在精灵文件夹中新进animator文件夹，并创建animator controller</p><li><p>将Animation文件夹中的idle basic拖到刚创建的controller中</p><li><p>将controller添加到01上</p><li><p>在根目录创建Resource文件夹，并在里面创建Pets文件夹，将01拖到pets文件夹中形成预制体</p><li><p>将场景中的01删掉</p><li><p>以相同的方式添加多个精灵</p><li><p>创建脚本InsPets.cs生成宠物</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">InsPets</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
    <span class="c1">//创建数组 存储精灵预制体</span>
    <span class="k">private</span> <span class="n">GameObject</span><span class="p">[]</span> <span class="n">pets</span><span class="p">;</span>
  
    <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">pets</span> <span class="p">=</span> <span class="n">Resources</span><span class="p">.</span><span class="n">LoadAll</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;(</span><span class="s">"Pets"</span><span class="p">);</span>
    <span class="p">}</span>
  
    <span class="c1">// Use this for initialization</span>
    <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nf">InsPet</span><span class="p">();</span>
    <span class="p">}</span>
  
    <span class="c1">// Update is called once per frame</span>
    <span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
  
    <span class="p">}</span>
  
    <span class="k">private</span> <span class="k">void</span> <span class="nf">InsPet</span><span class="p">()</span><span class="c1">//注意不要和脚本同名</span>
    <span class="p">{</span>
        <span class="c1">//随机生成一个精灵序号</span>
        <span class="kt">int</span> <span class="n">_petIndex</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">pets</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="c1">//生成精灵</span>
        <span class="nf">Instantiate</span><span class="p">(</span><span class="n">pets</span><span class="p">[</span><span class="n">_petIndex</span><span class="p">],</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>将脚本拖到之前创建的精灵预制体（圆柱），删掉圆柱的mesh</p></ul><h3 id="11随机事件与角色互动"><span class="mr-2">11.随机事件与角色互动</span><a href="#11随机事件与角色互动" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>互动事件：</strong></p><ol><li><p>角色碰撞到食物或者精灵球时，对应UI数字增加</p><li><p>角色碰到精灵时，出现面板询问是否捕捉</p></ol><p><strong>实现方式：</strong></p><ol><li><p>给事件添加碰撞器，使用触发碰撞器</p><li><p>给角色增加”Avatar“标签，并增加碰撞器</p><li><p>判断进入事件点碰撞器的物体标签是否为Avatar</p></ol><p><strong>具体流程：</strong></p><ul><li><p>搭建UI，在canvas新建image至左上角，命名为im_Ball,锚点设置在左上角</p><li><p>在im_Ball上添加text_Mark 作为×号和text_num作为数字，将锚点放在右侧（因为符号和数字在父物体img的右侧）</p><li><p>复制im_Ball做成food</p><li><p>创建Pics文件夹再在里面创建UI文件夹，将食物和精灵球图片拖入，将图片类型改为sprite</p><li><p>新建脚本UI_Mgr_02.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine.UI</span><span class="p">;</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">UI_Mgr_02</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
  
    <span class="c1">//储存精灵球和食物的数量</span>
    <span class="k">public</span> <span class="n">Text</span> <span class="n">Tx_BallNum</span><span class="p">;</span>
    <span class="k">public</span> <span class="n">Text</span> <span class="n">Tx_FoodNum</span><span class="p">;</span>
    <span class="c1">//申请静态类变量,便于其他脚本直接调用该类的方法</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">UI_Mgr_02</span> <span class="n">Instance</span><span class="p">;</span>
  
    <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Instance</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="k">public</span> <span class="k">void</span> <span class="nf">AddBallNum</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">_num</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">Tx_BallNum</span><span class="p">.</span><span class="n">text</span><span class="p">);</span>
        <span class="n">_num</span><span class="p">++;</span>
        <span class="n">Tx_BallNum</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">_num</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">AddFoodNum</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">_num</span> <span class="p">=</span> <span class="kt">int</span><span class="p">.</span><span class="nf">Parse</span><span class="p">(</span><span class="n">Tx_FoodNum</span><span class="p">.</span><span class="n">text</span><span class="p">);</span>
        <span class="n">_num</span><span class="p">++;</span>
        <span class="n">Tx_FoodNum</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">_num</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
    <span class="p">}</span>
  
<span class="p">}</span>
</pre></table></code></div></div><li><p>创建碰撞脚本Ball_Find.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">Ball_Find</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
  
    <span class="c1">//碰撞函数</span>
    <span class="k">void</span> <span class="nf">OnTriggerEnter</span><span class="p">(</span><span class="n">Collider</span> <span class="n">other</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">tag</span> <span class="p">==</span> <span class="s">"Avatar"</span><span class="p">)</span><span class="c1">//与标签为“Avatar”的物体碰撞</span>
        <span class="p">{</span>
            <span class="n">UI_Mgr_02</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">AddBallNum</span><span class="p">();</span>
            <span class="c1">//销毁物体</span>
            <span class="nf">Destroy</span><span class="p">(</span><span class="n">gameObject</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
  
<span class="p">}</span>
</pre></table></code></div></div><li><p>创建空物体UI_mgr并挂载上UI_Mgr_02.cs，将Im_Ball和Im_Food的数字text挂载到UI_Mgr_02.cs变量上（不要挂maker，不然会报错嗷）</p><li><p>更改ball的预制体，添加刚体组件并把限制constraint中的freeze全打上勾，使其不受物理的原因而移动变化，挂上ballFind脚本，将碰撞器的is trigger勾上</p><li><p>为boy物体添加”Avatar“标签和box_collider</p><li><p>食物同理</p></ul><h3 id="12触发精灵捕捉面板"><span class="mr-2">12.触发精灵捕捉面板</span><a href="#12触发精灵捕捉面板" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>面板内容：</strong></p><ol><li><p>提示信息：精灵种类</p><li><p>开始捕捉</p><li><p>放弃捕捉</p></ol><p><strong>流程：</strong></p><ul><li><p>在canvas上添加img_catch</p><li><p>在img_catch添加三个text分别是恭喜、发现宠物和宠物名字，再添加两个按钮，分别为捕捉和放弃</p><li><p>扩充UI_Mgr_02.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>    <span class="c1">//储存捕捉面板</span>
    <span class="k">public</span> <span class="n">GameObject</span> <span class="n">Im_Catch</span>
  
        <span class="c1">//设置捕捉面板的激活状态</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">SetIm_Catch</span><span class="p">(</span><span class="kt">bool</span> <span class="n">bl</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Im_Catch</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="n">bl</span><span class="p">);</span>
    <span class="p">};</span>
</pre></table></code></div></div><li><p>将捕捉面板物体挂载到ui管理物体的脚本上</p><li><p>创建脚本Pet_Find.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">Pet_Find</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
      <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//精灵初始朝向角色</span>
        <span class="n">transform</span><span class="p">.</span><span class="nf">LookAt</span><span class="p">(</span><span class="n">GameObject</span><span class="p">.</span><span class="nf">FindGameObjectWithTag</span><span class="p">(</span><span class="s">"Avatar"</span><span class="p">).</span><span class="n">transform</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">void</span> <span class="nf">OnTriggerEnter</span><span class="p">(</span><span class="n">Collider</span> <span class="n">other</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">tag</span> <span class="p">==</span> <span class="s">"Avatar"</span><span class="p">)</span><span class="c1">//与标签为“Avatar”的物体碰撞</span>
        <span class="p">{</span>
            <span class="n">UI_Mgr_02</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">SetIm_Catch</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
          <span class="c1">//销毁物体</span>
          <span class="nf">Destroy</span><span class="p">(</span><span class="n">gameObject</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
  
<span class="p">}</span>
</pre></table></code></div></div><li><p>为所有精灵添加碰撞体和刚体，像食物和精灵球那样调整，挂上PetFind.cs</p><li><p>为面板的放弃捕捉按钮添加im-mgr物体，并选上SetIm_Catch方法</p></ul><h3 id="12lbs部分重构"><span class="mr-2">12.LBS部分重构</span><a href="#12lbs部分重构" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p>在Resources文件夹中新建文件夹ball和foods</p><li><p>将prefab文件夹中的对应物体拖入刚新建的文件夹</p><li><p>重构PointEvent.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">PointEvent</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
  
    <span class="c1">//分别储存精灵、精灵球、食物的预制体</span>
    <span class="k">private</span> <span class="n">GameObject</span><span class="p">[]</span> <span class="n">Pets</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">GameObject</span><span class="p">[]</span> <span class="n">Balls</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">GameObject</span><span class="p">[]</span> <span class="n">Foods</span><span class="p">;</span>
    <span class="c1">//储存偏移量,让生成的物体高一点</span>
    <span class="k">private</span> <span class="n">Vector3</span> <span class="n">offset</span><span class="p">;</span>
    <span class="c1">// Use this for initialization</span>
    <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Balls</span> <span class="p">=</span> <span class="n">Resources</span><span class="p">.</span><span class="n">LoadAll</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;(</span><span class="s">"Balls"</span><span class="p">);</span>
        <span class="n">Foods</span> <span class="p">=</span> <span class="n">Resources</span><span class="p">.</span><span class="n">LoadAll</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;(</span><span class="s">"Foods"</span><span class="p">);</span>
        <span class="n">Pets</span> <span class="p">=</span> <span class="n">Resources</span><span class="p">.</span><span class="n">LoadAll</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;(</span><span class="s">"Pets"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
        <span class="n">offset</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">5f</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">_randomEvent</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">3</span><span class="p">);</span><span class="c1">//随机选 0 1 2</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_randomEvent</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="nf">insPet</span><span class="p">();</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">_randomEvent</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span> <span class="nf">insBall</span><span class="p">();</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">_randomEvent</span> <span class="p">==</span> <span class="m">2</span><span class="p">)</span> <span class="nf">insFood</span><span class="p">();</span>
    <span class="p">}</span>
  
    <span class="c1">// Update is called once per frame</span>
    <span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
  
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">insPet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 随机生成一个精灵序号</span>
        <span class="kt">int</span> <span class="n">_petIndex</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">Pets</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="nf">Instantiate</span><span class="p">(</span><span class="n">Pets</span><span class="p">[</span><span class="n">_petIndex</span><span class="p">],</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
    <span class="p">}</span>    
    <span class="k">private</span> <span class="k">void</span> <span class="nf">insFood</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">_foodIndex</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">Foods</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="nf">Instantiate</span><span class="p">(</span><span class="n">Foods</span><span class="p">[</span><span class="n">_foodIndex</span><span class="p">],</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
    <span class="p">}</span>    
    <span class="k">private</span> <span class="k">void</span> <span class="nf">insBall</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">_ballIndex</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">Foods</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="n">GameObject</span> <span class="n">_ball</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">Balls</span><span class="p">[</span><span class="n">_ballIndex</span><span class="p">],</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
        <span class="c1">//设置精灵球的角度</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">localEulerAngles</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(-</span><span class="m">30f</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
    <span class="p">}</span>
  
<span class="p">}</span>
</pre></table></code></div></div><li><p>删掉InsPet.cs和Pet预制体</p><li><p>使用代码为预制体增加组件，继续重构PointEvent.cs，修改脚本中的insBall和insFood函数即可</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre>  <span class="k">private</span> <span class="k">void</span> <span class="nf">insFood</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">_foodIndex</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">Foods</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="n">GameObject</span> <span class="n">_food</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">Foods</span><span class="p">[</span><span class="n">_foodIndex</span><span class="p">],</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
  
        <span class="c1">//添加碰撞体组件</span>
        <span class="n">_food</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">BoxCollider</span><span class="p">&gt;();</span>
        <span class="c1">//勾选isTrigger</span>
        <span class="n">_food</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">BoxCollider</span><span class="p">&gt;().</span><span class="n">isTrigger</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="c1">//设置碰撞体</span>
        <span class="n">_food</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">BoxCollider</span><span class="p">&gt;().</span><span class="n">center</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
        <span class="n">_food</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">BoxCollider</span><span class="p">&gt;().</span><span class="n">size</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0.33f</span><span class="p">,</span> <span class="m">0.3f</span><span class="p">,</span> <span class="m">0.33f</span><span class="p">);</span>
        <span class="c1">//添加刚体组件</span>
        <span class="n">_food</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">Rigidbody</span><span class="p">&gt;();</span>
        <span class="c1">//更改刚体组件的限制</span>
        <span class="n">_food</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Rigidbody</span><span class="p">&gt;().</span><span class="n">constraints</span> <span class="p">=</span> <span class="n">RigidbodyConstraints</span><span class="p">.</span><span class="n">FreezeAll</span><span class="p">;</span>
        <span class="c1">//添加moveeffect组件和find组件</span>
        <span class="n">_food</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">MoveEffect</span><span class="p">&gt;();</span>
        <span class="n">_food</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">Food_Find</span><span class="p">&gt;();</span>
    <span class="p">}</span>    
    <span class="k">private</span> <span class="k">void</span> <span class="nf">insBall</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">_ballIndex</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">Foods</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="n">GameObject</span> <span class="n">_ball</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">Balls</span><span class="p">[</span><span class="n">_ballIndex</span><span class="p">],</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
        <span class="c1">//设置精灵球的角度</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">localEulerAngles</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(-</span><span class="m">30f</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
        <span class="c1">//添加球形碰撞体组件</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">SphereCollider</span><span class="p">&gt;();</span>
        <span class="c1">//勾选isTrigger</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">SphereCollider</span><span class="p">&gt;().</span><span class="n">isTrigger</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="c1">//设置碰撞体大小</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">SphereCollider</span><span class="p">&gt;().</span><span class="n">radius</span> <span class="p">=</span> <span class="m">0.011f</span><span class="p">;</span>
        <span class="c1">//添加刚体组件</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">Rigidbody</span><span class="p">&gt;();</span>
        <span class="c1">//更改刚体组件的限制</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Rigidbody</span><span class="p">&gt;().</span><span class="n">constraints</span> <span class="p">=</span> <span class="n">RigidbodyConstraints</span><span class="p">.</span><span class="n">FreezeAll</span><span class="p">;</span>
        <span class="c1">//添加moveeffect组件和find组件</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">MoveEffect</span><span class="p">&gt;();</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">Ball_Find</span><span class="p">&gt;();</span>
    <span class="p">}</span>
</pre></table></code></div></div></ul><h3 id="13配置vuforia"><span class="mr-2">13.配置Vuforia</span><a href="#13配置vuforia" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ol><li><p>在周围随机出现精灵</p><li><p>发射精灵球</p><ul><li>新建一个项目pokemonGo_AR</ul></ol><ul><li><p>创建ARCamera时导入Vuforia的包</p><li><p>切换至安卓平台</p><li><p>更改playersetting中的XR settings 勾选Auforia</p><li><p>为ARcamera添加密钥</p><li><p>更改ARcamera下VuforiaConfiguraton的Device Tracker，勾选Track Device Pose</p><li><p>导出apk测试（导之前更改playersetting 里的名称还有other setting里的Android TV要取消掉）</p></ul><h3 id="14规划ar模块的制作生成精灵球"><span class="mr-2">14.规划AR模块的制作（生成精灵球）</span><a href="#14规划ar模块的制作生成精灵球" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>功能流程</strong></p><ol><li><p>读取数据</p><li><p>配置精灵球</p><li><p>配置精灵</p><li><p>可以发射精灵球</p><li><p>触发精灵捕捉成功</p></ol><p><strong>流程：</strong></p><ul><li><p>创建cube作为ballpos，调整位置与大小并拖给ARcamera作为子物体</p><li><p>创建一个球体作为精灵球，调整大小位置，删除碰撞器组件（因为要在代码中动态添加）</p><li><p>在Resources文件夹中创建Balls文件夹，并将球体拖进去作为预制体（在合并项目时，同名文件夹也会合并）</p><li><p>创建scripts文件夹再创建AR文件夹，在里面创建ARBallCtrl.cs脚本</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">ARBallCtrl</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
    <span class="c1">//储存精灵球预制体</span>
    <span class="k">private</span> <span class="n">GameObject</span><span class="p">[]</span> <span class="n">balls</span><span class="p">;</span>
    <span class="c1">//精灵球生成位置</span>
    <span class="k">public</span> <span class="n">Transform</span> <span class="n">PosInsBall</span><span class="p">;</span>
    <span class="c1">// Use this for initialization</span>
    <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">//加载路径在“Resources/Balls”的预制体</span>
        <span class="n">balls</span> <span class="p">=</span> <span class="n">Resources</span><span class="p">.</span><span class="n">LoadAll</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;(</span><span class="s">"Balls"</span><span class="p">);</span>
        <span class="nf">insBall</span><span class="p">();</span>
    <span class="p">}</span>
  
    <span class="c1">// Update is called once per frame</span>
    <span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
  
    <span class="p">}</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">insBall</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">Instantiate</span><span class="p">(</span><span class="n">balls</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">PosInsBall</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">PosInsBall</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
        <span class="c1">//设置精灵球的父物体 为了保证发射前始终在屏幕的固定位置</span>
      <span class="n">_ball</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">SetParent</span><span class="p">(</span><span class="n">PosInsBall</span><span class="p">);</span>
      <span class="c1">//为精灵球添加球体碰撞器组件</span>
      <span class="n">_ball</span><span class="p">.</span><span class="n">gameObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">SphereCollider</span><span class="p">&gt;();</span>
  
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>新建脚本管理器，添加ARBallCtrl.cs脚本，将BallPos拖到脚本中</p></ul><h3 id="15发射精灵球"><span class="mr-2">15.发射精灵球</span><a href="#15发射精灵球" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>发射效果</strong></p><ol><li><p>用手指滑动发射</p><li><p>发射后精灵球运动的过程类似于真实物体抛射</p><li><p>可以碰到精灵</p><li><p>受重力影响下落</p><li><p>落在地面上</p></ol><p><strong>制作思路</strong></p><ol><li><p>有碰撞器</p><li><p>有刚体</p><li><p>计算手指滑动方向</p><li><p>计算手指滑动距离</p><li><p>计算手指滑动的速度</p></ol><p><strong>注意事项</strong></p><ol><li><p>有的滑动方向不能触发精灵球发射</p><li><p>滑动距离不够不能触发精灵球发射</p><li><p>AR交互对算法的影响</p></ol><p><strong>流程</strong></p><ul><li><p>创建脚本ARShootBall.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">ARShootBall</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
  
    <span class="c1">//设置给精灵球的力度</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">FwdForce</span> <span class="p">=</span> <span class="m">200f</span><span class="p">;</span>
    <span class="c1">//设置夹角的参照数值</span>
    <span class="k">public</span> <span class="n">Vector3</span> <span class="n">StanTra</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1f</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
  
    <span class="c1">//判断手指是否碰到精灵球位置</span>
    <span class="k">private</span> <span class="kt">bool</span> <span class="n">blTouched</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="c1">//判断精灵球是否发射</span>
    <span class="k">private</span> <span class="kt">bool</span> <span class="n">blShooted</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="c1">//手指滑动起始点</span>
    <span class="k">private</span> <span class="n">Vector3</span> <span class="n">startPosition</span><span class="p">;</span>
    <span class="c1">//手指滑动的终点</span>
    <span class="k">private</span> <span class="n">Vector3</span> <span class="n">endPosition</span><span class="p">;</span>
    <span class="c1">//手指滑动的距离</span>
    <span class="k">private</span> <span class="kt">float</span> <span class="n">disFlick</span><span class="p">;</span>
    <span class="c1">//手指滑动的速度</span>
    <span class="k">private</span> <span class="kt">float</span> <span class="n">speedFlick</span><span class="p">;</span>
    <span class="c1">//手指滑动的时间(帧数)</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">timeFlick</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="c1">//手指滑动的偏移向量</span>
    <span class="k">private</span> <span class="n">Vector3</span> <span class="n">offset</span><span class="p">;</span>
    <span class="c1">//记录主摄像机</span>
    <span class="k">private</span> <span class="n">Camera</span> <span class="n">cameraMain</span><span class="p">;</span>
  
    <span class="c1">// Use this for initialization</span>
  
    <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">//赋值为主摄像机</span>
        <span class="n">cameraMain</span> <span class="p">=</span> <span class="n">Camera</span><span class="p">.</span><span class="n">main</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="c1">// Update is called once per frame</span>
    <span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">blTouched</span><span class="p">)</span><span class="c1">//如果按在小球上，允许检测手指的滑动</span>
        <span class="p">{</span>
            <span class="nf">slip</span><span class="p">();</span>
  
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//重置参数</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">resetVari</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//起始位置为手指按下的位置</span>
        <span class="n">startPosition</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">//当鼠标/手指 按下/触摸到 脚本挂载的物体</span>
    <span class="k">void</span> <span class="nf">OnMouseDown</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">blShooted</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span><span class="c1">//如果没发射</span>
        <span class="p">{</span>
            <span class="n">blTouched</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span><span class="c1">//允许检测手指滑动</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//计算手指的滑动</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">slip</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">timeFlick</span> <span class="p">+=</span> <span class="m">25</span><span class="p">;</span><span class="c1">//时间每帧增加25</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="nf">GetMouseButtonDown</span><span class="p">(</span><span class="m">0</span><span class="p">))</span><span class="c1">//当手指按下的时候</span>
        <span class="p">{</span>
            <span class="nf">resetVari</span><span class="p">();</span><span class="c1">//重置参数</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="nf">GetMouseButton</span><span class="p">(</span><span class="m">0</span><span class="p">))</span><span class="c1">//当手指一直按下的时候</span>
        <span class="p">{</span>
            <span class="c1">//将终点位置坐标刷新为手指位置</span>
            <span class="n">endPosition</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">;</span>
            <span class="c1">//获取手指在世界坐标上的偏移量</span>
            <span class="n">offset</span> <span class="p">=</span> <span class="n">cameraMain</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">rotation</span> <span class="p">*</span> <span class="p">(</span><span class="n">endPosition</span> <span class="p">-</span> <span class="n">startPosition</span><span class="p">);</span>
            <span class="c1">//计算手指滑动的距离</span>
            <span class="n">disFlick</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">Distance</span><span class="p">(</span><span class="n">endPosition</span><span class="p">,</span> <span class="n">startPosition</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="nf">GetMouseButtonUp</span><span class="p">(</span><span class="m">0</span><span class="p">))</span><span class="c1">//当手指抬起来</span>
        <span class="p">{</span>
            <span class="c1">//计算速度</span>
            <span class="n">speedFlick</span> <span class="p">=</span> <span class="n">disFlick</span> <span class="p">/</span> <span class="n">timeFlick</span><span class="p">;</span>
            <span class="c1">//手指触摸设置为false</span>
            <span class="n">blTouched</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="c1">//时间重置</span>
            <span class="n">timeFlick</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="c1">//如果手指滑动距离超过20而且是向上滑动</span>
            <span class="k">if</span><span class="p">(</span><span class="n">disFlick</span> <span class="p">&gt;</span> <span class="m">20</span> <span class="p">&amp;&amp;</span> <span class="n">endPosition</span><span class="p">.</span><span class="n">y</span><span class="p">-</span> <span class="n">startPosition</span><span class="p">.</span><span class="n">y</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">//允许发射</span>
                <span class="nf">shootBall</span><span class="p">();</span>
  
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
  
    <span class="c1">//发射精灵球</span>
    <span class="k">private</span> <span class="k">void</span> <span class="nf">shootBall</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//给精灵球添加刚体组件</span>
        <span class="n">transform</span><span class="p">.</span><span class="n">gameObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">Rigidbody</span><span class="p">&gt;();</span>
        <span class="c1">//使用局部变量储存刚体组件，便于后续操作</span>
        <span class="n">Rigidbody</span> <span class="n">_rigBall</span> <span class="p">=</span> <span class="n">transform</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Rigidbody</span><span class="p">&gt;();</span>
        <span class="c1">//给精灵球一个初始速度 </span>
        <span class="n">_rigBall</span><span class="p">.</span><span class="n">velocity</span> <span class="p">=</span> <span class="n">offset</span><span class="p">.</span><span class="n">normalized</span> <span class="p">*</span> <span class="n">speedFlick</span><span class="p">;</span>
        <span class="c1">//为精灵球添加力度,方向为朝着屏幕前方（即为摄像机的前方）</span>
        <span class="n">_rigBall</span><span class="p">.</span><span class="nf">AddForce</span><span class="p">(</span><span class="n">cameraMain</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">forward</span> <span class="p">*</span> <span class="n">FwdForce</span><span class="p">);</span>
        <span class="c1">//让精灵球旋转</span>
        <span class="n">_rigBall</span><span class="p">.</span><span class="nf">AddTorque</span><span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">right</span><span class="p">);</span>
        <span class="c1">//设置精灵球阻力 </span>
        <span class="n">_rigBall</span><span class="p">.</span><span class="n">drag</span> <span class="p">=</span> <span class="m">0.5f</span><span class="p">;</span>
        <span class="c1">//设置为发射状态</span>
        <span class="n">blShooted</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="c1">//让发射出去的球脱离父物体</span>
        <span class="n">transform</span><span class="p">.</span><span class="n">parent</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="c1">//执行协程函数</span>
        <span class="nf">StartCoroutine</span><span class="p">(</span><span class="nf">LateInsBall</span><span class="p">());</span>
    <span class="p">}</span>
  
    <span class="c1">//协程函数</span>
    <span class="n">IEnumerator</span> <span class="nf">LateInsBall</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="m">0.2f</span><span class="p">);</span>
        <span class="c1">//延迟两秒执行</span>
        <span class="c1">//生成新的精灵球</span>
        <span class="n">ARBallCtrl</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">InsNewBall</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>删掉BallPos的碰撞器和渲染插件，只需要为精灵球提供位置</p><li><p>将ARBallCtrl.cs的脚本生成新精灵球函数insBall改为公有函数方便调用，并修改：</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>  <span class="c1">//申请脚本静态类对象</span>
  <span class="k">public</span> <span class="k">static</span> <span class="n">ARBallCtrl</span> <span class="n">Instance</span><span class="p">;</span>
  <span class="k">public</span> <span class="k">void</span> <span class="nf">InsNewBall</span><span class="p">()</span>
</pre></table></code></div></div><li><p>创建材质文件夹，新建一个带颜色的材质赋给cube方便区分球和cube</p></ul><h3 id="16ar场景中生成精灵"><span class="mr-2">16.AR场景中生成精灵</span><a href="#16ar场景中生成精灵" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>流程</strong></p><ul><li><p>升高ARcamera的y坐标至1.6</p><li><p>在Resources文件夹新建Pets文件夹，将cube拖入作为预制体</p><li><p>在ARcamera的周围创建多个生成点cube</p><li><p>删除cube的碰撞器和网格（因为只需要提供位置）</p><li><p>新建空物体PosMgr统一管理生成点（作为生成点的父物体）</p><li><p>新建脚本ARInsPets.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">ARInsPet</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
  
    <span class="c1">//储存生成精灵位置的物体</span>
    <span class="k">public</span> <span class="n">Transform</span><span class="p">[]</span> <span class="n">TraPos</span><span class="p">;</span>
    <span class="c1">//储存精灵</span>
    <span class="k">private</span> <span class="n">GameObject</span><span class="p">[]</span> <span class="n">pets</span><span class="p">;</span>
    <span class="c1">// Use this for initialization</span>
    <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
        <span class="n">pets</span> <span class="p">=</span> <span class="n">Resources</span><span class="p">.</span><span class="n">LoadAll</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;(</span><span class="s">"Pets"</span><span class="p">);</span>
    <span class="p">}</span>
  
    <span class="c1">// Update is called once per frame</span>
    <span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
  
    <span class="p">}</span>
  
    <span class="k">public</span> <span class="k">void</span> <span class="nf">InsPet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//随机选一个生成的位置点</span>
        <span class="kt">int</span> <span class="n">_index</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">TraPos</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="c1">//获取该位置的transform</span>
        <span class="n">Transform</span> <span class="n">_tra</span> <span class="p">=</span> <span class="n">TraPos</span><span class="p">[</span><span class="n">_index</span><span class="p">];</span>
        <span class="c1">//在该位置生成精灵</span>
        <span class="nf">Instantiate</span><span class="p">(</span><span class="n">pets</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">_tra</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">_tra</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
  
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>将脚本挂载到PosMgr上，并将五个位置点cube放在脚本上</p></ul><h3 id="17地图模块与ar模块的整合"><span class="mr-2">17.地图模块与AR模块的整合</span><a href="#17地图模块与ar模块的整合" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>目标</strong></p><ol><li><p>将两个项目文件合并</p><li><p>测试调整整合后的项目场景</p><li><p>场景的跳转</p></ol><p><strong>流程</strong></p><ul><li><p>打开pokemonGo_map项目文件，导出包</p><li><p>复制pokemonGo_AR项目文件改名为pokemonGo_main，作为主项目文件</p><li><p>导入包</p><li><p>切换场景到map</p><li><p>测试，为防止鼠标移动到按钮时相机发生变化，新建一个ARcamera并关掉所有组件</p><li><p>切换场景到AR</p><li><p>由于在文件合并时，相同文件夹的内容也会合并，同名的预制体会覆盖之前的预制体，所以要调整Ball</p><li><p>制作捕捉精灵时的跳转函数，修改UI_Mgr脚本</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">UnityEngine.SceneManagement</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">void</span> <span class="nf">Btn_GoARScn</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="n">SceneManager</span><span class="p">.</span><span class="nf">LoadScene</span><span class="p">(</span><span class="s">"AR_Scn"</span><span class="p">);</span>
  <span class="p">}</span>
</pre></table></code></div></div><li><p>要将场景添加到build setting中</p><li><p>切换至AR_Scn,创建一个脚本ARUI_Mgr.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine.SceneManagement</span><span class="p">;</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">ARUI_Mgr</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
  
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Btn_GoMapScn</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">SceneManager</span><span class="p">.</span><span class="nf">LoadScene</span><span class="p">(</span><span class="s">"Map_Scn"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div></ul><h3 id="18resource中的预制体标准"><span class="mr-2">18.Resource中的预制体标准</span><a href="#18resource中的预制体标准" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>标准</strong></p><ol><li><p>同一文件夹中的预制体类型要相同</p><li><p>同一批预制体的配置信息保持一致（坐标轴位置、旋转角度、模型朝向、导出前的操作）</p><li><p>外部导入的资源在进入unity前就要统一标准</p></ol><p><strong>流程</strong></p><ul><li><p>修改ARInsPet脚本，使精灵大小合适，在生成精灵函数最后进行修改</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c1">//在该位置生成精灵</span>
        <span class="n">GameObject</span> <span class="n">_pet</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">pets</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">_tra</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">_tra</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
        <span class="c1">//调整缩放比例</span>
        <span class="n">_pet</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">localScale</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">0.5f</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">,</span> <span class="m">0.5f</span><span class="p">)</span> <span class="p">;</span>
</pre></table></code></div></div><li><p>将BallPos 的scale全改为1</p><li><p>修改ARBallCtrl.cs脚本中生成精灵球函数最后加上</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c1">//设置精灵球的大小为25倍</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">localScale</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">25f</span><span class="p">,</span> <span class="m">25f</span><span class="p">,</span> <span class="m">25f</span><span class="p">);</span>
</pre></table></code></div></div><li><p>用代码来调整碰撞器的缩放比，并添加发射精灵球脚本</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>        <span class="c1">//为精灵球添加发射精灵球脚本</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">gameObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">ARShootBall</span><span class="p">&gt;();</span>
        <span class="c1">//设置精灵球的大小为25倍</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">localScale</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">25f</span><span class="p">,</span> <span class="m">25f</span><span class="p">,</span> <span class="m">25f</span><span class="p">);</span>
        <span class="c1">//获取碰撞器并更改半径</span>
        <span class="n">_ball</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">SphereCollider</span><span class="p">&gt;().</span><span class="n">radius</span> <span class="p">=</span> <span class="m">0.01f</span><span class="p">;</span>
</pre></table></code></div></div></ul><h3 id="19数据的全局管理"><span class="mr-2">19.数据的全局管理</span><a href="#19数据的全局管理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>流程</strong></p><ul><li><p>切换至map场景，将img_Ball拖入Prefeb文件夹形成预制体</p><li><p>回到AR场景，将预制体拖到场景中</p><li><p>在脚本文件夹，创建Map文件夹，把之前的脚本拖到Map中</p><li><p>再新建一个Static文件夹，用来存放全局脚本</p><li><p>新建脚本StaticData.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">StaticData</span> <span class="p">{</span>
    <span class="c1">//精灵球初始数量</span>
    <span class="k">public</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">BallNum</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>修改UI_Mgr脚本</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>    <span class="c1">//精灵球数量</span>
  <span class="k">public</span> <span class="n">Text</span> <span class="n">Tx_BallNum</span><span class="p">;</span>
  <span class="c1">//单例</span>
  <span class="k">public</span> <span class="k">static</span> <span class="n">ARUI_Mgr</span> <span class="n">Instance</span><span class="p">;</span>
  <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="n">Instance</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">public</span> <span class="k">void</span> <span class="nf">UpdateUIBallNum</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="n">Tx_BallNum</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">StaticData</span><span class="p">.</span><span class="n">BallNum</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
  <span class="p">}</span>
</pre></table></code></div></div><li><p>修改ARBallCtrl脚本</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>    <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
      <span class="c1">//加载路径在“Resources/Balls”的预制体</span>
      <span class="n">balls</span> <span class="p">=</span> <span class="n">Resources</span><span class="p">.</span><span class="n">LoadAll</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;(</span><span class="s">"Balls"</span><span class="p">);</span>
      <span class="c1">//刷新精灵球数量</span>
      <span class="n">ARUI_Mgr</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">UpdateUIBallNum</span><span class="p">();</span>
      <span class="nf">InsNewBall</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">public</span> <span class="k">void</span> <span class="nf">InsNewBall</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">StaticData</span><span class="p">.</span><span class="n">BallNum</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
      <span class="p">{</span>
          <span class="n">GameObject</span> <span class="n">_ball</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">balls</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">PosInsBall</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">PosInsBall</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
          <span class="c1">//设置精灵球的父物体 为了保证发射前始终在屏幕的固定位置</span>
          <span class="n">_ball</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">SetParent</span><span class="p">(</span><span class="n">PosInsBall</span><span class="p">);</span>
          <span class="c1">//为精灵球添加球体碰撞器组件</span>
          <span class="n">_ball</span><span class="p">.</span><span class="n">gameObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">SphereCollider</span><span class="p">&gt;();</span>
          <span class="c1">//为精灵球添加发射精灵球脚本</span>
          <span class="n">_ball</span><span class="p">.</span><span class="n">gameObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">ARShootBall</span><span class="p">&gt;();</span>
          <span class="c1">//设置精灵球的大小为25倍</span>
          <span class="n">_ball</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">localScale</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="m">25f</span><span class="p">,</span> <span class="m">25f</span><span class="p">,</span> <span class="m">25f</span><span class="p">);</span>
          <span class="c1">//获取碰撞器并更改半径</span>
          <span class="n">_ball</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">SphereCollider</span><span class="p">&gt;().</span><span class="n">radius</span> <span class="p">=</span> <span class="m">0.01f</span><span class="p">;</span>
  
      <span class="p">}</span>
  <span class="p">}</span>
</pre></table></code></div></div><li><p>修改精灵球发射脚本ARShootBall中的发射函数，在发射结束后添加以下两行代码</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>        <span class="c1">//减少精灵球数量</span>
        <span class="n">StaticData</span><span class="p">.</span><span class="n">BallNum</span><span class="p">--;</span>
        <span class="c1">//更新UI</span>
        <span class="n">ARUI_Mgr</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">UpdateUIBallNum</span><span class="p">();</span>
</pre></table></code></div></div><li><p>回到地图场景</p><li><p>修改UI_Mgr_02.cs脚本，增加start函数，初始化场景精灵球数量，修改增加精灵球数量</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>    <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Tx_BallNum</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">StaticData</span><span class="p">.</span><span class="n">BallNum</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">AddBallNum</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">StaticData</span><span class="p">.</span><span class="n">BallNum</span><span class="p">++;</span>
        <span class="n">Tx_BallNum</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">StaticData</span><span class="p">.</span><span class="n">BallNum</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
    <span class="p">}</span>
</pre></table></code></div></div><li><p>保存精灵的全局变量：修改StaticData.cs脚本</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>    <span class="c1">//当前正要捕捉的精灵序号</span>
    <span class="k">public</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">CatchingPetIndex</span><span class="p">;</span>
</pre></table></code></div></div><li><p>修改Pet_Find脚本，修改void OnTriggerEnter(Collider other)函数</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">void</span> <span class="nf">OnTriggerEnter</span><span class="p">(</span><span class="n">Collider</span> <span class="n">other</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">tag</span> <span class="p">==</span> <span class="s">"Avatar"</span><span class="p">)</span><span class="c1">//与标签为“Avatar”的物体碰撞</span>
        <span class="p">{</span>
            <span class="c1">//显示捕捉面板</span>
            <span class="n">UI_Mgr_02</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">SetIm_Catch</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
            <span class="c1">//当与角色碰撞时，更改全局变量：要捕捉的精灵序号</span>
            <span class="n">StaticData</span><span class="p">.</span><span class="n">CatchingPetIndex</span> <span class="p">=</span> <span class="n">PetIndex</span><span class="p">;</span>
            <span class="c1">//销毁物体</span>
            <span class="nf">Destroy</span><span class="p">(</span><span class="n">gameObject</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></table></code></div></div><li><p>修改PointEvent脚本的生成精灵函数</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">private</span> <span class="k">void</span> <span class="nf">insPet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 随机生成一个精灵序号</span>
        <span class="kt">int</span> <span class="n">_petIndex</span> <span class="p">=</span> <span class="n">Random</span><span class="p">.</span><span class="nf">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">Pets</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>
        <span class="c1">//储存随机生成的精灵</span>
        <span class="n">GameObject</span> <span class="n">_pet</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">Pets</span><span class="p">[</span><span class="n">_petIndex</span><span class="p">],</span> <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">transform</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
        <span class="c1">//更新精灵的序号</span>
        <span class="n">_pet</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Pet_Find</span><span class="p">&gt;().</span><span class="n">PetIndex</span> <span class="p">=</span> <span class="n">_petIndex</span><span class="p">;</span>
    <span class="p">}</span>    
</pre></table></code></div></div><li><p>回到AR场景，修改ARInsPet脚本中的InsPet函数。并修改start函数</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>    <span class="c1">//在该位置生成要捕捉的精灵</span>
    <span class="n">GameObject</span> <span class="n">_pet</span> <span class="p">=</span> <span class="nf">Instantiate</span><span class="p">(</span><span class="n">pets</span><span class="p">[</span><span class="n">StaticData</span><span class="p">.</span><span class="n">CatchingPetIndex</span><span class="p">],</span> <span class="n">_tra</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">_tra</span><span class="p">.</span><span class="n">rotation</span><span class="p">);</span>
  
<span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
    <span class="n">pets</span> <span class="p">=</span> <span class="n">Resources</span><span class="p">.</span><span class="n">LoadAll</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;(</span><span class="s">"Pets"</span><span class="p">);</span>
    <span class="c1">//生成精灵</span>
    <span class="nf">InsPet</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>删掉之前生成精灵的按钮</p></ul><h3 id="20精灵捕捉的处理"><span class="mr-2">20.精灵捕捉的处理</span><a href="#20精灵捕捉的处理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>功能效果</strong></p><ol><li><p>精灵播放被捕捉到的动画</p><li><p>精灵消失</p><li><p>显示捕捉成功界面</p></ol><p><strong>流程</strong></p><ul><li><p>打开PetsAnimator</p><li><p>打开Animation_FBX文件夹，将Hurt_die动画和jump_basic动画拖到Animator中</p><li><p>连接：Any State -&gt; hurt -&gt; jump</p><li><p>添加一个Trigger参数Catched</p><li><p>将Any State -&gt; hurt的连线condition添加参数Catched</p><li><p>回到AR场景，在canvas上创建一个Panel组件Pn_Catched，锚点在四角</p><li><p>在panel上添加输入框</p><li><p>新建两个按钮，一个是确认，一个是放生</p><li><p>修改ARUI.Mgr脚本，添加以下内容</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>    <span class="c1">//储存面板</span>
    <span class="k">public</span> <span class="n">GameObject</span> <span class="n">PnCatched</span><span class="p">;</span>
      <span class="k">public</span> <span class="k">void</span> <span class="nf">Show_PnCatched</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="n">PnCatched</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
  <span class="p">}</span>
</pre></table></code></div></div><li><p>给精灵球添加Ball标签</p><li><p>修改PetFind脚本</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="c1">//延迟两秒显示捕捉面板并销毁精灵</span>
  <span class="n">IEnumerator</span> <span class="nf">ShowCatchedPn</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForSeconds</span><span class="p">(</span><span class="m">2f</span><span class="p">);</span>
      <span class="c1">//显示捕捉面板</span>
      <span class="n">ARUI_Mgr</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">Show_PnCatched</span><span class="p">();</span>
      <span class="c1">//销毁精灵物体</span>
      <span class="nf">Destroy</span><span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">gameObject</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">//播放被捕捉的动画</span>
  <span class="k">private</span> <span class="k">void</span> <span class="nf">playCatched</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="n">transform</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Animator</span><span class="p">&gt;().</span><span class="nf">SetTrigger</span><span class="p">(</span><span class="s">"Catched"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">void</span> <span class="nf">OnTriggerEnter</span><span class="p">(</span><span class="n">Collider</span> <span class="n">other</span><span class="p">)</span>
  <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">tag</span> <span class="p">==</span> <span class="s">"Avatar"</span><span class="p">)</span><span class="c1">//与标签为“Avatar”的物体碰撞</span>
      <span class="p">{</span>
          <span class="c1">//显示捕捉面板</span>
          <span class="n">UI_Mgr_02</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">SetIm_Catch</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
          <span class="c1">//当与角色碰撞时，更改全局变量：要捕捉的精灵序号</span>
          <span class="n">StaticData</span><span class="p">.</span><span class="n">CatchingPetIndex</span> <span class="p">=</span> <span class="n">PetIndex</span><span class="p">;</span>
          <span class="c1">//销毁物体</span>
          <span class="nf">Destroy</span><span class="p">(</span><span class="n">gameObject</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">tag</span> <span class="p">==</span> <span class="s">"Ball"</span><span class="p">)</span>
      <span class="p">{</span>
          <span class="c1">//播放动画</span>
          <span class="nf">playCatched</span><span class="p">();</span>
          <span class="c1">//显示面板</span>
          <span class="nf">ShowCatchedPn</span><span class="p">();</span>
  
      <span class="p">}</span>
  <span class="p">}</span>
</pre></table></code></div></div></ul><h3 id="21精灵命名"><span class="mr-2">21.精灵命名</span><a href="#21精灵命名" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>流程</strong></p><ul><li><p>在脚本文件夹中创建Pet文件夹，新建PetSave脚本</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">PetSave</span><span class="p">{</span>
    <span class="c1">//记录精灵名字</span>
    <span class="k">private</span> <span class="kt">string</span> <span class="n">strName</span> <span class="p">=</span> <span class="s">"未命名宠物"</span><span class="p">;</span>
    <span class="c1">//记录精灵模型的序号</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">petIndex</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="c1">//精灵名字属性</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">PetName</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">strName</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="n">strName</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//精灵序号属性</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">PetIndex</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">petIndex</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="n">petIndex</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
  
    <span class="c1">//构造函数</span>
    <span class="k">public</span> <span class="nf">PetSave</span><span class="p">(</span><span class="kt">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PetName</span> <span class="p">=</span> <span class="n">name</span><span class="p">;</span>
        <span class="n">PetIndex</span> <span class="p">=</span> <span class="n">index</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>修改全局数据脚本StaticData</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>    <span class="c1">//申请列表储存捕捉到的精灵</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">PetSave</span><span class="p">&gt;</span> <span class="n">PetList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">PetSave</span><span class="p">&gt;();</span>
    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 向全局数据的精灵列表中添加精灵</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="c1">/// &lt;param name="petSave"&gt;精灵的属性类 &lt;/param&gt;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">AddPet</span><span class="p">(</span><span class="n">PetSave</span> <span class="n">petSave</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PetList</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">petSave</span><span class="p">);</span>
    <span class="p">}</span>
</pre></table></code></div></div><li><p>修改ARUI.Mgr脚本，为捕捉面板的按钮添加函数</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>   <span class="c1">//储存精灵名字</span>
  <span class="k">public</span> <span class="n">Text</span> <span class="n">InputPetName</span><span class="p">;</span>
    <span class="c1">//捕捉面板的确认按钮</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Btn_Yes</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//从输入框中获取精灵名字</span>
        <span class="kt">string</span> <span class="n">_name</span> <span class="p">=</span> <span class="n">InputPetName</span><span class="p">.</span><span class="n">text</span><span class="p">;</span>
        <span class="c1">//从全局脚本中获取精灵序号</span>
        <span class="kt">int</span> <span class="n">_index</span> <span class="p">=</span> <span class="n">StaticData</span><span class="p">.</span><span class="n">CatchingPetIndex</span><span class="p">;</span>
        <span class="c1">//向全局脚本的精灵列表中添加一条精灵属性类数据</span>
        <span class="n">StaticData</span><span class="p">.</span><span class="nf">AddPet</span><span class="p">(</span><span class="k">new</span> <span class="nf">PetSave</span><span class="p">(</span> <span class="n">_name</span><span class="p">,</span> <span class="n">_index</span><span class="p">));</span>
    <span class="p">}</span>
</pre></table></code></div></div></ul><h3 id="22精灵仓库的制作"><span class="mr-2">22.精灵仓库的制作</span><a href="#22精灵仓库的制作" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>流程</strong></p><ul><li><p>新建Store.Scn场景</p><li><p>创建Text，修改canvas的canves Scaler中mode为Scale with the screen Size并修改分辨率为1080*1920</p><li><p>调整text大小尺寸，命名为Tx_Title并将锚点放在左上角</p><li><p>新建按钮放在右上角，返回</p><li><p>新建画布Cav_world，修改canves Scaler中mode为Scale with the screen Size并修改分辨率为1080*1920</p><li><p>在Cav_world上新建panel调整大小</p><li><p>在panel上新建text组件保存信息：宠物名称和宠物类型</p><li><p>添加image用来储存精灵图</p><li><p>再复制两个panel</p><li><p>将摄像机模式改为正交模式并调整相机大小</p><li><p>将Cav_World的canvas组件中Render Mode改为Camera，并将main camera拖到Render camera上</p><li><p>创建三个空物体储存精灵的位置</p><li><p>新建空物体Pos_Mgr管理这三个位置</p><li><p>在脚本文件夹中新建文件夹Store，创建新脚本StoreInsPets.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">StoreInsPet</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
    <span class="c1">//储存展示的位置</span>
    <span class="k">public</span> <span class="n">Transform</span><span class="p">[]</span> <span class="n">Pos</span><span class="p">;</span>
    <span class="c1">//储存所有精灵预制体</span>
    <span class="k">private</span> <span class="n">GameObject</span><span class="p">[]</span> <span class="n">pets</span><span class="p">;</span>
  
    <span class="c1">//储存展示的精灵</span>
    <span class="k">private</span> <span class="n">GameObject</span><span class="p">[]</span> <span class="n">petsShow</span> <span class="p">=</span> <span class="k">new</span> <span class="n">GameObject</span><span class="p">[</span><span class="m">3</span><span class="p">];</span>
  
    <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">pets</span> <span class="p">=</span> <span class="n">Resources</span><span class="p">.</span><span class="n">LoadAll</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;(</span><span class="s">"Pets"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// Use this for initialization</span>
    <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nf">InsPet</span><span class="p">();</span>
    <span class="p">}</span>
  
    <span class="c1">// Update is called once per frame</span>
    <span class="k">void</span> <span class="nf">Update</span> <span class="p">()</span> <span class="p">{</span>
  
    <span class="p">}</span>
  
    <span class="k">public</span> <span class="k">void</span> <span class="nf">InsPet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// 获取精灵数量</span>
        <span class="kt">int</span> <span class="n">_petNum</span> <span class="p">=</span> <span class="n">StaticData</span><span class="p">.</span><span class="n">PetList</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span>
        <span class="c1">//如果仓库中有精灵</span>
        <span class="k">if</span><span class="p">(</span><span class="n">_petNum</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">3</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="c1">//如果i大于了最后一个精灵的序号</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="p">&gt;</span> <span class="p">(</span><span class="n">_petNum</span> <span class="p">-</span> <span class="m">1</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
                <span class="c1">//储存精灵信息</span>
                <span class="n">PetSave</span> <span class="n">_petInfo</span> <span class="p">=</span> <span class="n">StaticData</span><span class="p">.</span><span class="n">PetList</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                <span class="c1">//生成精灵</span>
                <span class="nf">Instantiate</span><span class="p">(</span><span class="n">pets</span><span class="p">[</span><span class="n">_petInfo</span><span class="p">.</span><span class="n">PetIndex</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">position</span><span class="p">,</span> <span class="n">Pos</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rotation</span><span class="p">);</span>
  
                <span class="c1">//获取精灵的名字</span>
                <span class="kt">string</span> <span class="n">_petNm</span> <span class="p">=</span> <span class="n">_petInfo</span><span class="p">.</span><span class="n">PetName</span><span class="p">;</span>
                <span class="c1">//更新精灵的名字</span>
                <span class="n">StoreUIMgr</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">UpdatePetNm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">_petNm</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
  
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>新建脚本StoreUIMgr.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine.UI</span><span class="p">;</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">StoreUIMgr</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
    <span class="c1">//显示精灵名字的text</span>
    <span class="k">public</span> <span class="n">Text</span><span class="p">[]</span> <span class="n">PetName</span><span class="p">;</span>
    <span class="c1">//显示精灵类型的text</span>
    <span class="k">public</span> <span class="n">Text</span><span class="p">[]</span> <span class="n">PetType</span><span class="p">;</span>
    <span class="c1">//单例</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">StoreUIMgr</span> <span class="n">Instance</span><span class="p">;</span>
  
    <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Instance</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="c1">//更新精灵的名字函数</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">UpdatePetNm</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">string</span> <span class="n">strName</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">PetName</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">text</span> <span class="p">=</span> <span class="n">strName</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>新建一个空物体Mgr，并将刚才创建的两个脚本挂载上去</p><li><p>将三个位置物体挂载到Mgr的StoreInsPets下，三个名字和类型text挂载到Mgr的StoreUIMgr</p><li><p>切换到AR场景，在ARUI_Mgr脚本的Btn_Yes()函数最后加上跳转场景的代码</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>        <span class="c1">//跳转到仓库界面</span>
        <span class="n">SceneManager</span><span class="p">.</span><span class="nf">LoadScene</span><span class="p">(</span><span class="s">"Store_Scn"</span><span class="p">);</span>
</pre></table></code></div></div><li><p>给确定按钮绑定上Mgr物体上的ARUI_Mgr脚本的Btn_Yes()函数</p><li><p>由于精灵仓库场景中ARcamera的影响使得精灵显示不正常，新建一个ARcamera，关掉组件</p></ul><h3 id="23完善"><span class="mr-2">23.完善</span><a href="#23完善" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>场景切换设计：</strong></p><ol><li><p>地图场景：</p><ul><li><p>可随时跳转到精灵仓库</p><li><p>碰到精灵时可跳转到AR场景</p></ul><li><p>AR场景：</p><ul><li><p>随时跳转到精灵仓库</p><li><p>捕捉成功跳转到精灵仓库</p><li><p>随时跳转到地图场景</p><li><p>放弃捕捉时跳转到地图场景</p></ul><li><p>仓库场景</p><ul><li>随时跳转到地图场景</ul></ol><p><strong>流程</strong></p><ul><li><p>修改StoreUIMgr脚本，添加场景切换函数</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">UnityEngine.SceneManagement</span><span class="p">;</span>
    <span class="c1">//跳转到地图场景</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Btn_ToMap</span><span class="p">()</span>
  <span class="p">{</span>
      <span class="n">SceneManager</span><span class="p">.</span><span class="nf">LoadScene</span><span class="p">(</span><span class="s">"Map_Scn"</span><span class="p">);</span>
  <span class="p">}</span>
</pre></table></code></div></div><li><p>给返回按钮添加Mgr物体，选择StoreUIMgr脚本的Btn_ToMap()函数</p><li><p>返回Map场景，复制扫描按钮，命名为精灵仓库</p><li><p>修改UI_Mgr_02脚本，添加跳转场景函数</p><li><p>回到AR场景，复制回到地图按钮，命名精灵仓库</p><li><p>修改ARUI_Mgr脚本，添加跳转到精灵仓库和放生的函数</p></ul><p><strong>完善</strong></p><ol><li><p>AR场景</p><li><p>仓库场景</p></ol><p><strong>流程</strong></p><ul><li><p>修改ARInsPet脚本，将ARcamera挂载到脚本上</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1">//储存相机位置</span>
<span class="k">public</span> <span class="n">Transform</span> <span class="n">CameraTra</span><span class="p">;</span>
  
 <span class="nf">InsPet</span><span class="p">()</span><span class="err">中最后添加：</span>
<span class="c1">//让生成的精灵面向我们</span>
<span class="n">_pet</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="nf">LookAt</span><span class="p">(</span><span class="k">new</span> <span class="nf">Vector3</span><span class="p">(</span><span class="n">CameraTra</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">_pet</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span><span class="p">,</span> <span class="n">CameraTra</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="p">));</span>
</pre></table></code></div></div><li><p>切换到精灵仓库场景，添加宠物类型显示功能，修改StoreUIMgr脚本，添加刷新精灵种类的函数</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 刷新精灵类型函数</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="c1">/// &lt;param name="index"&gt;精灵序号&lt;/param&gt;</span>
    <span class="c1">/// &lt;param name="strType"&gt;精灵类型名字&lt;/param&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">UpadatePetType</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">string</span> <span class="n">strType</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Tx_PetType</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">text</span> <span class="p">=</span> <span class="n">strType</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div><li><p>再StaticData脚本中定义一个静态函数，用来根据序号返回精灵的种类</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">GetPetName</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">index</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="s">"不灭狂雷"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">index</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="s">"牛头酋长"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="p">==</span> <span class="m">2</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="s">"赤小兔"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="p">==</span> <span class="m">3</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="s">"沙漠皇帝"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="p">==</span> <span class="m">4</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="s">"乌迪尔"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="p">==</span> <span class="m">5</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="s">"傲之追猎者"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="p">==</span> <span class="m">6</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="s">"麻花藤"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="p">==</span> <span class="m">7</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="s">"沙漠死神"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="s">"不屈之枪"</span><span class="p">;</span>
        <span class="p">}</span>
  
    <span class="p">}</span>
</pre></table></code></div></div><li><p>修改StoreInsPet脚本，在InsPet函数最后添加刷新类型的函数</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>    <span class="c1">/// &lt;summary&gt;</span>
    <span class="c1">/// 刷新精灵类型函数</span>
    <span class="c1">/// &lt;/summary&gt;</span>
    <span class="c1">/// &lt;param name="index"&gt;精灵序号&lt;/param&gt;</span>
    <span class="c1">/// &lt;param name="strType"&gt;精灵类型名字&lt;/param&gt;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">UpadatePetType</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">string</span> <span class="n">strType</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Tx_PetType</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">text</span> <span class="p">=</span> <span class="n">strType</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div></ul><h3 id="24美术及音效"><span class="mr-2">24.美术及音效</span><a href="#24美术及音效" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p>新建一个登录场景Login_Scn</p><li><p>为防止Vuforia的影响，先创建一个ARcamera，关掉所有组件</p><li><p>在Pic文件夹中创建Icons、Btn、InputF、BG、Words文件夹，把之前的图标图片放到Icons中，导入美术资源，设置为sprite，记得apply</p><li><p>创建canvas，再创建一个panel作为背景</p><li><p>将导入的背景图片设置为panel的源图像，并将不透明度调为100%</p><li><p>在背景Panel上新建image，并选择导入的美术资源，设置锚点（就近原则）</p><li><p>新建inputfile，一个输入用户名，一个输入密码</p><li><p>新建一个登录按钮</p><li><p>新建几个image装饰一下</p><li><p>为登录添加跳转功能，在脚本文件夹新建Login文件夹，创建Login_UI脚本</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine.SceneManagement</span><span class="p">;</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Login_UI</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
  
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Login</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">SceneManager</span><span class="p">.</span><span class="nf">LoadScene</span><span class="p">(</span><span class="s">"Map_Scn"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>新建管理器物体，将脚本挂载到管理器上，为按钮添加跳转功能</p><li><p>新建一个文件夹Audios，存放音乐与音效，导入音乐包</p><li><p>创建一个空物体管理声音AuMgr（用来添加按钮的音源）,在Mgr添加audio source组件，勾选loop，选择一个bgm导入</p><li><p>创建一个脚本Login_Au</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">Login_Au</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
  
    <span class="k">private</span> <span class="n">AudioSource</span> <span class="n">Au</span><span class="p">;</span>
    <span class="c1">//静态单例</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Login_Au</span> <span class="n">Instance</span><span class="p">;</span>
  
    <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Instance</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Use this for initialization</span>
    <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
        <span class="n">Au</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">AudioSource</span><span class="p">&gt;();</span>
    <span class="p">}</span>
  
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Btn_Play</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Au</span><span class="p">.</span><span class="nf">Play</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>切换到Map场景，换掉场景中所有按钮图片</p><li><p>为Mgr添加音源</p><li><p>新建脚本Map_Au</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">class</span> <span class="nc">Map_Au</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
  
    <span class="k">private</span> <span class="n">AudioSource</span> <span class="n">Au</span><span class="p">;</span>
    <span class="c1">//静态单例</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Map_Au</span> <span class="n">Instance</span><span class="p">;</span>
  
    <span class="k">void</span> <span class="nf">Awake</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Instance</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Use this for initialization</span>
    <span class="k">void</span> <span class="nf">Start</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Au</span> <span class="p">=</span> <span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">AudioSource</span><span class="p">&gt;();</span>
    <span class="p">}</span>
  
    <span class="k">public</span> <span class="k">void</span> <span class="nf">Btn_Play</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Au</span><span class="p">.</span><span class="nf">Play</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><li><p>新建空物体AuMgr，挂载声音控制脚本</p><li><p>给每个按钮的响应函数内添加一条：</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>        <span class="c1">//播放按钮声音</span>
        <span class="n">Map_Au</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">Btn_Play</span><span class="p">();</span>
</pre></table></code></div></div><li><p>切换到AR界面</p><li><p>更改UI按钮、添加BGM、按钮音效、AR场景的AU管理脚本</p><li><p>切换到精灵仓库界面，重复上面的操作</p></ul><h3 id="25游戏保存功能"><span class="mr-2">25.游戏保存功能</span><a href="#25游戏保存功能" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p>导入Easy Save包</p><li><p>切换到仓库场景，复制一个按钮为保存</p><li><p>在静态脚本文件夹创建脚本SaveAndLoad.cs</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>
  
<span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">SaveAndLoad</span><span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Save</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">//保存精灵球数量</span>
        <span class="n">ES3</span><span class="p">.</span><span class="n">Save</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">"BallNum"</span><span class="p">,</span> <span class="n">StaticData</span><span class="p">.</span><span class="n">BallNum</span><span class="p">);</span>
        <span class="c1">//保存已捕捉的精灵的数量</span>
        <span class="n">ES3</span><span class="p">.</span><span class="n">Save</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">"PetNum"</span><span class="p">,</span> <span class="n">StaticData</span><span class="p">.</span><span class="n">PetList</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
        <span class="c1">//保存每一个已捕捉到的精灵信息</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">StaticData</span><span class="p">.</span><span class="n">PetList</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="c1">//储存每一个精灵的名字</span>
            <span class="n">ES3</span><span class="p">.</span><span class="n">Save</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="s">"PetName"</span> <span class="p">+</span> <span class="n">i</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(),</span> <span class="n">StaticData</span><span class="p">.</span><span class="n">PetList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">PetName</span><span class="p">);</span>
            <span class="c1">//储存每一个精灵的序号</span>
            <span class="n">ES3</span><span class="p">.</span><span class="n">Save</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">"PetIndex"</span> <span class="p">+</span> <span class="n">i</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(),</span> <span class="n">StaticData</span><span class="p">.</span><span class="n">PetList</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">PetIndex</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//加载函数</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Load</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ES3</span><span class="p">.</span><span class="nf">KeyExists</span><span class="p">(</span><span class="s">"BallNum"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">ES3</span><span class="p">.</span><span class="nf">KeyExists</span><span class="p">(</span><span class="s">"PetNum"</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">//读取精灵球数量</span>
            <span class="n">StaticData</span><span class="p">.</span><span class="n">BallNum</span> <span class="p">=</span> <span class="n">ES3</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">"BallNum"</span><span class="p">);</span>
            <span class="c1">//读取精灵数量</span>
            <span class="kt">int</span> <span class="n">_petNum</span> <span class="p">=</span> <span class="n">ES3</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">"PetNum"</span><span class="p">);</span>
            <span class="c1">//读取每个精灵的信息</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">_petNum</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="kt">string</span> <span class="n">_petName</span> <span class="p">=</span> <span class="n">ES3</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="s">"PetName"</span> <span class="p">+</span> <span class="n">i</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
                <span class="kt">int</span> <span class="n">_petIndex</span> <span class="p">=</span> <span class="n">ES3</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">"PetIndex"</span> <span class="p">+</span> <span class="n">i</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
                <span class="n">StaticData</span><span class="p">.</span><span class="nf">AddPet</span><span class="p">(</span><span class="k">new</span> <span class="nf">PetSave</span><span class="p">(</span><span class="n">_petName</span><span class="p">,</span> <span class="n">_petIndex</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
  
<span class="p">}</span>
</pre></table></code></div></div><li><p>修改StoreUI_Mgr脚本，添加保存按钮的函数，并给按钮加上函数</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>    <span class="k">public</span> <span class="k">void</span> <span class="nf">Btn_Save</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Store_Au</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">Btn_Play</span><span class="p">();</span>
        <span class="n">SaveAndLoad</span><span class="p">.</span><span class="nf">Save</span><span class="p">();</span>
    <span class="p">}</span>
</pre></table></code></div></div><li><p>将加载函数加载登录的按钮函数内（在LoginUI脚本中），登录即读取</p><div class="language-csharp highlighter-rouge"><div class="code-header"> <span data-label-text="C#"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>    <span class="k">public</span> <span class="k">void</span> <span class="nf">Login</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Login_Au</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="nf">Btn_Play</span><span class="p">();</span>
        <span class="n">SaveAndLoad</span><span class="p">.</span><span class="nf">Load</span><span class="p">();</span>
        <span class="n">SceneManager</span><span class="p">.</span><span class="nf">LoadScene</span><span class="p">(</span><span class="s">"Map_Scn"</span><span class="p">);</span>
    <span class="p">}</span>
</pre></table></code></div></div></ul><h2 id="三项目界面展示"><span class="mr-2">三、项目界面展示</span><a href="#三项目界面展示" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="table-wrapper"><table><thead><tr><th>界面<th>介绍<tbody><tr><td><a href="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039903.jpg" class="popup img-link "><img data-src="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039903.jpg" alt="" class="lazyload" data-proofer-ignore></a><td>登录界面：该界面用户名密码其实并没有效果， 点击登录，会自动读取上一次的记录并跳转到地图界面<tr><td><a href="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039904.jpg" class="popup img-link "><img data-src="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039904.jpg" alt="" class="lazyload" data-proofer-ignore></a><td>地图界面：打开app后允许gps功能，玩家在现实世界移动，游戏世界的角色也会跟着移动，地图为学校。左上方显示精灵球和食物数量，通过点击右上角的扫描区域，可以在周围随机刷新精灵球、食物和精灵。玩家碰撞到精灵球、食物，数量会增加，碰撞到精灵弹出捕捉面板<tr><td><a href="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039907.jpg" class="popup img-link "><img data-src="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039907.jpg" alt="" class="lazyload" data-proofer-ignore></a><td>AR战斗界面：玩家手持手机环顾四周，寻找精灵，找到精灵后，通过滑动手指的动作来投掷精灵球，碰撞到精灵便捕捉成功，捕捉成功后显示成功面板，起名确认后跳转到仓库界面，否则跳转到地图界面<tr><td><a href="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039902.jpg" class="popup img-link "><img data-src="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039902.jpg" alt="" class="lazyload" data-proofer-ignore></a><td>仓库界面：玩家捕捉的精灵将显示在该界面，点击保存将会保存当前精灵，下次登录时会自动读取</table></div><h2 id="四实验中遇到的问题"><span class="mr-2">四、实验中遇到的问题</span><a href="#四实验中遇到的问题" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ol><li><p>环境配置问题，如下</p><p><a href="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039908.jpg" class="popup img-link "><img data-src="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039908.jpg" alt="" class="lazyload" data-proofer-ignore></a></p></ol><p>    在上一次实验时，我就想导出安卓包，但出现了SDK的各种问题，先是找不到SDK，然后是版本低，不能够支持最新版本的Vuforia，尝试了很多办法。最开始解决找不到SDK时，把Unity卸载了重装，但安装又出现了问题，又看博客的单独安装，就是把各种需要的模块、包、SDK等等单独下载，再整合一起，找到SDK了，但版本又不支持，于是又重新下载了最新的Unity，但最新的Unity的安卓sdk版本依旧不支持最新版本的Auforia，于是乎，便排查出不是Unity的问题，而是安卓包和Auforia版本不匹配的问题，最后又下回了Unity2020的稳定版本，导入Vuforia后，降低Vuforia的版本后能够成功导出安卓包了。但此次实验的环境是Unity2017，因为Unity2017自带Vuforia，更方便，根本不用担心安卓包和Auforia版本不匹配的问题。</p><ol><li>实验开始阶段MapBox的密钥申请问题</ol><p>    MapBox以往和Vuforia是一样的，只要注册登录就可以申请密钥，使用其LBS插件的功能，但今年有所变化，注册账号必须要visa等国际银行卡，但这种银行卡不是随随便便轻而易举就能办下来的，所以正在我一筹莫展之时，MapBox一小时后还是给我发来了验证邮件，没有银行卡还是注册账号成功了。</p><ol><li><p>中间有时会发生一些小bug，不过无足轻重很快就能调整好，比较麻烦的问题是最后的canvas布局问题</p><p><a href="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039906.jpg" class="popup img-link "><img data-src="https://raw.githubusercontent.com/CALL1CE/ImgStage/main/202206021039906.jpg" alt="" class="lazyload" data-proofer-ignore></a></p></ol><p>    导到手机上测试时，发现仓库界面的精灵信息面板发生重叠，发现是分辨率的不同导致的，电脑上设置的分辨率是1080*1920，而我的手机估计是10：21的比例，所以有所不同，于是查阅博客对canvas scaler的描述，更改canvas scaler的UI Scale Mode为 Scale With Screen Size，并根据情况更改Match即可，像上面这个，宽度其实不用缩放，只需要根据手机的高度来缩放UI的高度即可，因此Match拉到1。</p><h2 id="五个人收获"><span class="mr-2">五、个人收获</span><a href="#五个人收获" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>    本项目的技术难点不多，大多学习到的是项目的管理和游戏基本功能在Unity中的实现</p><ol><li><p>项目管理方式，为不同模块创建不同的文件夹存放脚本、预制体、资源等内容。在场景中使用不同的Manager空物体来管理场景中的脚本事件，比如Au_Mgr管理音频的脚本事件，Mgr管理场景主要事件的脚本，UI_Mgr管理界面的事件脚本。</p><li><p>项目的合并，相同文件夹会自动合并，在开发不同模块的功能时，如AR场景和地图场景可以分开开发，开发完毕后再合并项目。</p><li><p>使用Unity的Resources文件夹加载预制体，不用再一个一个手动拖拽添加了，节省了不少人力。</p><li><p>强力插件的运用，本项目就使用了GoMap插件和Easy Save插件，使用强力的插件能够节约开发时间</p><li><p>静态脚本以及单例的运用。使用静态脚本储存全局变量，可以保存场景切换时的数据，这一点与GameMaker Studio2的global变量如出一辙，并且要利用静态脚本实现保存和读取的功能，本项目使用了插件，只用实现保存和读取功能能即可，在GameMaker Studio2中还需要多两步，就是保存为json文件和读取json文件，整体流程很相似。单例可以直接使用类.单例名来调用该类的函数，功能和静态脚本很相似。</p></ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/unity3d/'>Unity3D</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/%E8%99%9A%E6%8B%9F%E7%8E%B0%E5%AE%9E/" class="post-tag no-text-decoration" >虚拟现实</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-tag no-text-decoration" >学习笔记</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%E5%A4%8D%E5%88%BB%E3%80%8APokemonGo%E3%80%8B%E9%83%A8%E5%88%86%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%20-%20CALL1CE&url=%2Fposts%2F%25E5%25A4%258D%25E5%2588%25BB-PokemonGo-%25E9%2583%25A8%25E5%2588%2586%25E5%258A%259F%25E8%2583%25BD%25E7%259A%2584%25E5%25AD%25A6%25E4%25B9%25A0%25E8%25AE%25B0%25E5%25BD%2595%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%E5%A4%8D%E5%88%BB%E3%80%8APokemonGo%E3%80%8B%E9%83%A8%E5%88%86%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%20-%20CALL1CE&u=%2Fposts%2F%25E5%25A4%258D%25E5%2588%25BB-PokemonGo-%25E9%2583%25A8%25E5%2588%2586%25E5%258A%259F%25E8%2583%25BD%25E7%259A%2584%25E5%25AD%25A6%25E4%25B9%25A0%25E8%25AE%25B0%25E5%25BD%2595%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2F%25E5%25A4%258D%25E5%2588%25BB-PokemonGo-%25E9%2583%25A8%25E5%2588%2586%25E5%258A%259F%25E8%2583%25BD%25E7%259A%2584%25E5%25AD%25A6%25E4%25B9%25A0%25E8%25AE%25B0%25E5%25BD%2595%2F&text=%E5%A4%8D%E5%88%BB%E3%80%8APokemonGo%E3%80%8B%E9%83%A8%E5%88%86%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95%20-%20CALL1CE" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" data-title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/GAMES105-Lecture-02-Math-Background/">GAMES105-Lecture 02 Math Background</a><li><a href="/posts/GAMES105-Lecture-03-Character-Kinematics/">GAMES105-Lecture 03 Character Kinematics</a><li><a href="/posts/GAMES105-Lecture-01-Introduction-to-Character-Animation/">GAMES105-Lecture 01 Introduction to Character Animation</a><li><a href="/posts/GAMES104-Lecture-12-%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E4%B8%AD%E7%9A%84%E7%B2%92%E5%AD%90%E5%92%8C%E5%A3%B0%E6%95%88%E7%B3%BB%E7%BB%9F/">GAMES104-Lecture 12 游戏引擎中的粒子和声效系统</a><li><a href="/posts/GAMES101-Lecture-16-Ray-Tracing-4-&-%E4%BD%9C%E4%B8%9A7/">GAMES101-Lecture 16 Ray Tracing 4(Monte Carlo Path Tracing) & 作业7</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a> <a class="post-tag" href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/">图形学</a> <a class="post-tag" href="/tags/%E6%A8%A1%E6%8B%9F/">模拟</a> <a class="post-tag" href="/tags/%E8%B4%AA%E5%BF%83/">贪心</a> <a class="post-tag" href="/tags/%E5%93%88%E5%B8%8C%E8%A1%A8/">哈希表</a> <a class="post-tag" href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86/">二叉树的遍历</a> <a class="post-tag" href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/">动态规划</a> <a class="post-tag" href="/tags/%E5%9B%9E%E6%BA%AF/">回溯</a> <a class="post-tag" href="/tags/%E6%8E%92%E5%BA%8F/">排序</a> <a class="post-tag" href="/tags/%E6%95%B0%E5%AD%A6/">数学</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/GAMES101-Lecture-01-Overview-of-Computer-Graphics/"><div class="card-body"> <em class="small" data-ts="1658288400" data-df="YYYY/MM/DD" > 2022/07/20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GAMES101-Lecture 01 Overview of Computer Graphics</h3><div class="text-muted small"><p> 1. What is Computer Graphics?     涉及到的领域： Video Game Movies Animations Design Visualization Virtual Reality Augumented Reality ...</p></div></div></a></div><div class="card"> <a href="/posts/GAMES101-Lecture-02-Review-of-Linear-Algebra/"><div class="card-body"> <em class="small" data-ts="1658555580" data-df="YYYY/MM/DD" > 2022/07/23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GAMES101-Lecture 02 Review of Linear Algebra</h3><div class="text-muted small"><p> 阅读材料：第 2 章（Miscellaneous Math）；第 5 章（Linear Algebra） 1. Graphics’ Dependencies 基础数学：线代、微积分、统计 基础物理：光学、力学 其它：信号处理、数值分析 2. This Course More dependent on li...</p></div></div></a></div><div class="card"> <a href="/posts/GAMES101-Lecture-03-Transformation/"><div class="card-body"> <em class="small" data-ts="1658586000" data-df="YYYY/MM/DD" > 2022/07/23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>GAMES101-Lecture 03 Transformation</h3><div class="text-muted small"><p> Transformation Scale \[\left[ \begin{matrix} x\prime\\ y\prime \end{matrix}\right]= \left[ \begin{matrix} s_x &amp;amp; 0\\ 0 &amp;amp; s_y \end{matrix}\right] \left[ \begin{matrix} x\\ y \end{matrix}\ri...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/%E5%8A%9B%E6%89%A3-%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F-&-%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8FII/" class="btn btn-outline-primary" prompt="上一篇"><p>力扣-跳跃游戏 & 跳跃游戏II</p></a> <a href="/posts/%E5%8A%9B%E6%89%A3-K%E6%AC%A1%E5%8F%96%E5%8F%8D%E5%90%8E%E6%9C%80%E5%A4%A7%E5%8C%96%E7%9A%84%E6%95%B0%E7%BB%84%E5%92%8C-&-%E5%8A%A0%E6%B2%B9%E7%AB%99/" class="btn btn-outline-primary" prompt="下一篇"><p>力扣-K次取反后最大化的数组和 & 加油站</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a> <a class="post-tag" href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/">图形学</a> <a class="post-tag" href="/tags/%E6%A8%A1%E6%8B%9F/">模拟</a> <a class="post-tag" href="/tags/%E8%B4%AA%E5%BF%83/">贪心</a> <a class="post-tag" href="/tags/%E5%93%88%E5%B8%8C%E8%A1%A8/">哈希表</a> <a class="post-tag" href="/tags/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86/">二叉树的遍历</a> <a class="post-tag" href="/tags/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92/">动态规划</a> <a class="post-tag" href="/tags/%E5%9B%9E%E6%BA%AF/">回溯</a> <a class="post-tag" href="/tags/%E6%8E%92%E5%BA%8F/">排序</a> <a class="post-tag" href="/tags/%E6%95%B0%E5%AD%A6/">数学</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/username">CALL1CE</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0">本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> (function () { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE ? "dark" : "default"); let config = {theme: expectedTheme}; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function () { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Create mermaid tag */ $("pre").has("code.language-mermaid").each(function () { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<pre class=\"mermaid\">${svgCode}</pre>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); })(); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/zh.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
